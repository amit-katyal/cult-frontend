"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk_N_E"] = self["webpackChunk_N_E"] || []).push([["_app-pages-browser_node_modules_thirdweb-dev_sdk_dist_marketplace-2e2adc0e_browser_esm_js"],{

/***/ "(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/marketplace-2e2adc0e.browser.esm.js":
/*!*********************************************************************************!*\
  !*** ./node_modules/@thirdweb-dev/sdk/dist/marketplace-2e2adc0e.browser.esm.js ***!
  \*********************************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Marketplace: function() { return /* binding */ Marketplace; }\n/* harmony export */ });\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ethers */ \"(app-pages-browser)/./node_modules/@ethersproject/bignumber/lib.esm/bignumber.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ethers */ \"(app-pages-browser)/./node_modules/@ethersproject/constants/lib.esm/addresses.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ethers */ \"(app-pages-browser)/./node_modules/@ethersproject/units/lib.esm/index.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ethers */ \"(app-pages-browser)/./node_modules/@ethersproject/constants/lib.esm/bignumbers.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ethers */ \"(app-pages-browser)/./node_modules/@ethersproject/address/lib.esm/index.js\");\n/* harmony import */ var ethers__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ethers */ \"(app-pages-browser)/./node_modules/@ethersproject/contracts/lib.esm/index.js\");\n/* harmony import */ var tiny_invariant__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tiny-invariant */ \"(app-pages-browser)/./node_modules/tiny-invariant/dist/esm/tiny-invariant.js\");\n/* harmony import */ var _QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./QueryParams-32a56510.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/QueryParams-32a56510.browser.esm.js\");\n/* harmony import */ var _fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./fetchCurrencyValue-32d08b05.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/fetchCurrencyValue-32d08b05.browser.esm.js\");\n/* harmony import */ var _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./index-33cd3415.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/index-33cd3415.browser.esm.js\");\n/* harmony import */ var _marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./marketplace-e3129e2f.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/marketplace-e3129e2f.browser.esm.js\");\n/* harmony import */ var _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./transactions-72f9603c.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/transactions-72f9603c.browser.esm.js\");\n/* harmony import */ var _contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./contract-appuri-5c40af52.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/contract-appuri-5c40af52.browser.esm.js\");\n/* harmony import */ var _contract_interceptor_d7b164a7_browser_esm_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./contract-interceptor-d7b164a7.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/contract-interceptor-d7b164a7.browser.esm.js\");\n/* harmony import */ var _contract_platform_fee_e756e68f_browser_esm_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./contract-platform-fee-e756e68f.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/contract-platform-fee-e756e68f.browser.esm.js\");\n/* harmony import */ var _contract_roles_71988d2e_browser_esm_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./contract-roles-71988d2e.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/contract-roles-71988d2e.browser.esm.js\");\n/* harmony import */ var _cleanCurrencyAddress_ded19cfe_browser_esm_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./cleanCurrencyAddress-ded19cfe.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/cleanCurrencyAddress-ded19cfe.browser.esm.js\");\n/* harmony import */ var _normalizePriceValue_9851c0eb_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./normalizePriceValue-9851c0eb.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/normalizePriceValue-9851c0eb.browser.esm.js\");\n/* harmony import */ var _setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./setErc20Allowance-7f76f677.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/setErc20Allowance-7f76f677.browser.esm.js\");\n/* harmony import */ var _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ListingType-cba090cb.browser.esm.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/ListingType-cba090cb.browser.esm.js\");\n/* harmony import */ var bn_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bn.js */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/node_modules/bn.js/lib/bn.js\");\n/* harmony import */ var bn_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bn_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var bs58__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! bs58 */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/node_modules/bs58/index.js\");\n/* harmony import */ var bs58__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(bs58__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var eventemitter3__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! eventemitter3 */ \"(app-pages-browser)/./node_modules/eventemitter3/index.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/**\n * Handles auction listings\n * @public\n */\nclass MarketplaceAuction {\n  constructor(contractWrapper, storage) {\n    this.contractWrapper = contractWrapper;\n    this.storage = storage;\n    this.encoder = new _fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.C(contractWrapper);\n  }\n  getAddress() {\n    return this.contractWrapper.address;\n  }\n\n  /** ******************************\n   * READ FUNCTIONS\n   *******************************/\n\n  /**\n   * Get an Auction listing by id\n   *\n   * @param listingId - the listing Id\n   * @returns The Auction listing object\n   */\n  async getListing(listingId) {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.listingId.toString() !== listingId.toString()) {\n      throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.L(this.getAddress(), listingId.toString());\n    }\n    if (listing.listingType !== _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Auction) {\n      throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.W(this.getAddress(), listingId.toString(), \"Direct\", \"Auction\");\n    }\n    return await this.mapListing(listing);\n  }\n\n  /**\n   * Get Highest Bid\n   *\n   * @remarks Get the current highest bid of an active auction.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction that closed\n   * const listingId = 0;\n   *\n   * contract.auction.\n   *   .getWinningBid(listingId)\n   *   .then((offer) => console.log(offer))\n   *   .catch((err) => console.error(err));\n   * ```\n   */\n  async getWinningBid(listingId) {\n    await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    const offers = await this.contractWrapper.read(\"winningBid\", [listingId]);\n    if (offers.offeror === ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero) {\n      return undefined;\n    }\n    return await (0,_marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.m)(this.contractWrapper.getProvider(), ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId), offers);\n  }\n\n  /**\n   * Get Auction Winner\n   *\n   * @remarks Get the winner of the auction after an auction ends.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction that closed\n   * const listingId = 0;\n   *\n   * contract.auction.\n   *   .getWinner(listingId)\n   *   .then((auctionWinner) => console.log(auctionWinner))\n   *   .catch((err) => console.error(err));\n   * ```\n   */\n  async getWinner(listingId) {\n    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    const offers = await this.contractWrapper.read(\"winningBid\", [listingId]);\n    const now = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(Math.floor(Date.now() / 1000));\n    const endTime = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listing.endTimeInEpochSeconds);\n\n    // if we have a winner in the map and the current time is past the endtime of the auction return the address of the winner\n    if (now.gt(endTime) && offers.offeror !== ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero) {\n      return offers.offeror;\n    }\n    // otherwise fall back to query filter things\n\n    // TODO this should be via indexer or direct contract call\n    const contractEvents = new _contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_10__.a(this.contractWrapper);\n    const closedAuctions = await contractEvents.getEvents(\"AuctionClosed\");\n    const auction = closedAuctions.find(a => a.data.listingId.eq(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId)));\n    if (!auction) {\n      throw new Error(`Could not find auction with listingId ${listingId} in closed auctions`);\n    }\n    return auction.data.winningBidder;\n  }\n\n  /** ******************************\n   * WRITE FUNCTIONS\n   *******************************/\n\n  /**\n   * Create Auction\n   *\n   * @remarks Create a new auction where people can bid on an asset.\n   *\n   * @example\n   * ```javascript\n   * // Data of the auction you want to create\n   * const auction = {\n   *   // address of the contract the asset you want to list is on\n   *   assetContractAddress: \"0x...\",\n   *   // token ID of the asset you want to list\n   *   tokenId: \"0\",\n   *  // when should the listing open up for offers\n   *   startTimestamp: new Date(),\n   *   // how long the listing will be open for\n   *   listingDurationInSeconds: 86400,\n   *   // how many of the asset you want to list\n   *   quantity: 1,\n   *   // address of the currency contract that will be used to pay for the listing\n   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,\n   *   // how much people would have to bid to instantly buy the asset\n   *   buyoutPricePerToken: \"10\",\n   *   // the minimum bid that will be accepted for the token\n   *   reservePricePerToken: \"1.5\",\n   * }\n   *\n   * const tx = await contract.auction.createListing(auction);\n   * const receipt = tx.receipt; // the transaction receipt\n   * const id = tx.id; // the id of the newly created listing\n   * ```\n   */\n  createListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listing => {\n    (0,_marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.v)(listing);\n    const resolvedAssetAddress = await (0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.aL)(listing.assetContractAddress);\n    const resolvedCurrencyAddress = await (0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.aL)(listing.currencyContractAddress);\n    await (0,_marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.h)(this.contractWrapper, this.getAddress(), resolvedAssetAddress, listing.tokenId, await this.contractWrapper.getSignerAddress());\n    const normalizedPricePerToken = await (0,_normalizePriceValue_9851c0eb_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__.n)(this.contractWrapper.getProvider(), listing.buyoutPricePerToken, resolvedCurrencyAddress);\n    const normalizedReservePrice = await (0,_normalizePriceValue_9851c0eb_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__.n)(this.contractWrapper.getProvider(), listing.reservePricePerToken, resolvedCurrencyAddress);\n    let listingStartTime = Math.floor(listing.startTimestamp.getTime() / 1000);\n    const block = await this.contractWrapper.getProvider().getBlock(\"latest\");\n    const blockTime = block.timestamp;\n    if (listingStartTime < blockTime) {\n      listingStartTime = blockTime;\n    }\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"createListing\",\n      args: [{\n        assetContract: resolvedAssetAddress,\n        tokenId: listing.tokenId,\n        buyoutPricePerToken: normalizedPricePerToken,\n        currencyToAccept: (0,_cleanCurrencyAddress_ded19cfe_browser_esm_js__WEBPACK_IMPORTED_MODULE_13__.c)(resolvedCurrencyAddress),\n        listingType: _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Auction,\n        quantityToList: listing.quantity,\n        reservePricePerToken: normalizedReservePrice,\n        secondsUntilEndTime: listing.listingDurationInSeconds,\n        startTime: ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingStartTime)\n      }],\n      parse: receipt => {\n        const event = this.contractWrapper.parseLogs(\"ListingAdded\", receipt?.logs);\n        return {\n          id: event[0].args.listingId,\n          receipt\n        };\n      }\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Create a batch of new auctions\n   *\n   * @remarks Create a batch of new auctions on the marketplace\n   *\n   * @example\n   * ```javascript\n   * const auctions = [...];\n   * const tx = await contract.auction.createListingsBatch(auctions);\n   * ```\n   */\n  createListingsBatch = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listings => {\n    const data = (await Promise.all(listings.map(listing => this.createListing.prepare(listing)))).map(tx => tx.encode());\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"multicall\",\n      args: [data],\n      parse: receipt => {\n        const events = this.contractWrapper.parseLogs(\"ListingAdded\", receipt?.logs);\n        return events.map(event => {\n          return {\n            id: event.args.listingId,\n            receipt\n          };\n        });\n      }\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Buyout Auction\n   *\n   * @remarks Buy a specific direct listing from the marketplace.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to buy\n   * const listingId = 0;\n   *\n   * await contract.auction.buyoutListing(listingId);\n   * ```\n   */\n  buyoutListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listingId => {\n    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    const currencyMetadata = await (0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.f)(this.contractWrapper.getProvider(), listing.currencyContractAddress);\n    return this.makeBid.prepare(listingId, ethers__WEBPACK_IMPORTED_MODULE_14__.formatUnits(listing.buyoutPrice, currencyMetadata.decimals));\n  });\n\n  /**\n   * Bid On Auction\n   *\n   * @remarks Make a bid on an auction listing\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to bid on\n   * const listingId = 0;\n   * // The price you are willing to bid for a single token of the listing\n   * const pricePerToken = 1;\n   *\n   * await contract.auction.makeBid(listingId, pricePerToken);\n   * ```\n   */\n  makeBid = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async (listingId, pricePerToken) => {\n    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    const normalizedPrice = await (0,_normalizePriceValue_9851c0eb_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__.n)(this.contractWrapper.getProvider(), pricePerToken, listing.currencyContractAddress);\n    if (normalizedPrice.eq(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(0))) {\n      throw new Error(\"Cannot make a bid with 0 value\");\n    }\n    const bidBuffer = await this.contractWrapper.read(\"bidBufferBps\", []);\n    const winningBid = await this.getWinningBid(listingId);\n    if (winningBid) {\n      const isWinner = (0,_marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.a)(winningBid.pricePerToken, normalizedPrice, bidBuffer);\n      (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(isWinner, \"Bid price is too low based on the current winning bid and the bid buffer\");\n    } else {\n      const tokenPrice = normalizedPrice;\n      const reservePrice = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listing.reservePrice);\n      (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(tokenPrice.gte(reservePrice), \"Bid price is too low based on reserve price\");\n    }\n    const quantity = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listing.quantity);\n    const value = normalizedPrice.mul(quantity);\n    const overrides = (await this.contractWrapper.getCallOverrides()) || {};\n    await (0,_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_15__.s)(this.contractWrapper, value, listing.currencyContractAddress, overrides);\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"offer\",\n      args: [listingId, listing.quantity, listing.currencyContractAddress, normalizedPrice, ethers__WEBPACK_IMPORTED_MODULE_16__.MaxUint256],\n      overrides\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Cancel Auction Listing\n   *\n   * @remarks Cancel an auction listing on the marketplace\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction listing you want to cancel\n   * const listingId = \"0\";\n   *\n   * await contract.auction.cancelListing(listingId);\n   * ```\n   */\n  cancelListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listingId => {\n    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    const now = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(Math.floor(Date.now() / 1000));\n    const startTime = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listing.startTimeInEpochSeconds);\n    const offers = await this.contractWrapper.read(\"winningBid\", [listingId]);\n    if (now.gt(startTime) && offers.offeror !== ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero) {\n      throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.t(listingId.toString());\n    }\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"closeAuction\",\n      args: [ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId), await this.contractWrapper.getSignerAddress()]\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Close the Auction for the buyer or the seller\n   *\n   * @remarks Closes the Auction and executes the sale for the buyer or the seller.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction listing you want to close\n   * const listingId = \"0\";\n   * await contract.auction.closeListing(listingId);\n   * ```\n   *\n   * @param listingId - the auction  listing ud to close\n   * @param closeFor - optionally pass the auction creator address or winning bid offeror address to close the auction on their behalf\n   */\n  closeListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async (listingId, closeFor) => {\n    if (!closeFor) {\n      closeFor = await this.contractWrapper.getSignerAddress();\n    }\n    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    try {\n      const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n        contractWrapper: this.contractWrapper,\n        method: \"closeAuction\",\n        args: [ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId), closeFor]\n      });\n      tx.setGasLimitMultiple(1.2);\n      return tx;\n    } catch (err) {\n      if (err.message.includes(\"cannot close auction before it has ended\")) {\n        throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.w(listingId.toString(), listing.endTimeInEpochSeconds.toString());\n      } else {\n        throw err;\n      }\n    }\n  });\n\n  /**\n   * Execute the Auction Sale\n   *\n   * @remarks Closes the Auction and executes the sale for both parties.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the auction listing you want to close\n   * const listingId = \"0\";\n   * await contract.auction.executeSale(listingId);\n   * ```\n   *\n   * @param listingId - the auction  listing ud to close\n   */\n  executeSale = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listingId => {\n    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    try {\n      const winningBid = await this.getWinningBid(listingId);\n      (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(winningBid, \"No winning bid found\");\n      const closeForSeller = this.encoder.encode(\"closeAuction\", [listingId, listing.sellerAddress]);\n      const closeForBuyer = this.encoder.encode(\"closeAuction\", [listingId, winningBid.buyerAddress]);\n      const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n        contractWrapper: this.contractWrapper,\n        method: \"multicall\",\n        args: [closeForSeller, closeForBuyer]\n      });\n      tx.setGasLimitMultiple(1.2);\n      return tx;\n    } catch (err) {\n      if (err.message.includes(\"cannot close auction before it has ended\")) {\n        throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.w(listingId.toString(), listing.endTimeInEpochSeconds.toString());\n      } else {\n        throw err;\n      }\n    }\n  });\n\n  /**\n   * Update an Auction listing with new metadata\n   * @param listing - the listing id to update\n   */\n  updateListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listing => {\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"updateListing\",\n      args: [listing.id, listing.quantity, listing.reservePrice, listing.buyoutPrice, listing.currencyContractAddress, listing.startTimeInEpochSeconds, listing.endTimeInEpochSeconds]\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Get the buffer in basis points between offers\n   */\n  async getBidBufferBps() {\n    return this.contractWrapper.read(\"bidBufferBps\", []);\n  }\n\n  /**\n   * returns the minimum bid a user can place to outbid the previous highest bid\n   * @param listingId - the listing id of the auction\n   */\n  async getMinimumNextBid(listingId) {\n    // we can fetch all of these at the same time using promise.all\n    const [currentBidBufferBps, winningBid, listing] = await Promise.all([this.getBidBufferBps(), this.getWinningBid(listingId), this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId))]);\n    const currentBidOrReservePrice = winningBid ?\n    // if there is a winning bid use the value of it\n    winningBid.currencyValue.value :\n    // if there is no winning bid use the reserve price\n    listing.reservePrice;\n    const minimumNextBid = currentBidOrReservePrice.add(\n    // the addition of the current bid and the buffer\n    // (have to divide by 10000 to get the fraction of the buffer (since it's in basis points))\n    currentBidOrReservePrice.mul(currentBidBufferBps).div(10000));\n\n    // it's more useful to return a currency value here\n    return (0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.a)(this.contractWrapper.getProvider(), listing.currencyContractAddress, minimumNextBid);\n  }\n\n  /** ******************************\n   * PRIVATE FUNCTIONS\n   *******************************/\n\n  /**\n   * Throws error if listing could not be found\n   *\n   * @param listingId - Listing to check for\n   */\n  async validateListing(listingId) {\n    try {\n      return await this.getListing(listingId);\n    } catch (err) {\n      console.error(`Error getting the listing with id ${listingId}`);\n      throw err;\n    }\n  }\n\n  /**\n   * Helper method maps the auction listing to the auction listing interface.\n   *\n   * @internal\n   * @param listing - The listing to map, as returned from the contract.\n   * @returns  The mapped interface.\n   */\n  async mapListing(listing) {\n    return {\n      assetContractAddress: listing.assetContract,\n      buyoutPrice: ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listing.buyoutPricePerToken),\n      currencyContractAddress: listing.currency,\n      buyoutCurrencyValuePerToken: await (0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.a)(this.contractWrapper.getProvider(), listing.currency, listing.buyoutPricePerToken),\n      id: listing.listingId.toString(),\n      tokenId: listing.tokenId,\n      quantity: listing.quantity,\n      startTimeInEpochSeconds: listing.startTime,\n      asset: await (0,_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_17__.c)(listing.assetContract, this.contractWrapper.getProvider(), listing.tokenId, this.storage),\n      reservePriceCurrencyValuePerToken: await (0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.a)(this.contractWrapper.getProvider(), listing.currency, listing.reservePricePerToken),\n      reservePrice: ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listing.reservePricePerToken),\n      endTimeInEpochSeconds: listing.endTime,\n      sellerAddress: listing.tokenOwner,\n      type: _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Auction\n    };\n  }\n}\n\n/**\n * Handles direct listings\n * @public\n */\nclass MarketplaceDirect {\n  constructor(contractWrapper, storage) {\n    this.contractWrapper = contractWrapper;\n    this.storage = storage;\n  }\n  getAddress() {\n    return this.contractWrapper.address;\n  }\n\n  /** ******************************\n   * READ FUNCTIONS\n   *******************************/\n\n  /**\n   * Get a direct listing by id\n   *\n   * @param listingId - the listing id\n   * @returns The Direct listing object\n   */\n  async getListing(listingId) {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.assetContract === ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero) {\n      throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.L(this.getAddress(), listingId.toString());\n    }\n    if (listing.listingType !== _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Direct) {\n      throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.W(this.getAddress(), listingId.toString(), \"Auction\", \"Direct\");\n    }\n    return await this.mapListing(listing);\n  }\n\n  /**\n   * Get the active offer on a listing\n   * @param listingId - the listing id\n   * @param address - the address that made the offer\n   */\n  async getActiveOffer(listingId, address) {\n    await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(ethers__WEBPACK_IMPORTED_MODULE_18__.isAddress(address), \"Address must be a valid address\");\n    const offers = await this.contractWrapper.read(\"offers\", [listingId, await (0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.aL)(address)]);\n    if (offers.offeror === ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero) {\n      return undefined;\n    }\n    return await (0,_marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.m)(this.contractWrapper.getProvider(), ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId), offers);\n  }\n\n  /** ******************************\n   * WRITE FUNCTIONS\n   *******************************/\n\n  /**\n   * Create Direct Listing\n   *\n   * @remarks Create a new listing on the marketplace where people can buy an asset directly.\n   *\n   * @example\n   * ```javascript\n   * // Data of the listing you want to create\n   * const listing = {\n   *   // address of the contract the asset you want to list is on\n   *   assetContractAddress: \"0x...\",\n   *   // token ID of the asset you want to list\n   *   tokenId: \"0\",\n   *   // when should the listing open up for offers\n   *   startTimestamp: new Date(),\n   *   // how long the listing will be open for\n   *   listingDurationInSeconds: 86400,\n   *   // how many of the asset you want to list\n   *   quantity: 1,\n   *   // address of the currency contract that will be used to pay for the listing\n   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,\n   *   // how much the asset will be sold for\n   *   buyoutPricePerToken: \"1.5\",\n   * }\n   *\n   * const tx = await contract.direct.createListing(listing);\n   * const receipt = tx.receipt; // the transaction receipt\n   * const id = tx.id; // the id of the newly created listing\n   * ```\n   */\n  createListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listing => {\n    (0,_marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.v)(listing);\n    const resolvedAssetAddress = await (0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.aL)(listing.assetContractAddress);\n    const resolvedCurrencyAddress = await (0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.aL)(listing.currencyContractAddress);\n    await (0,_marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.h)(this.contractWrapper, this.getAddress(), resolvedAssetAddress, listing.tokenId, await this.contractWrapper.getSignerAddress());\n    const normalizedPricePerToken = await (0,_normalizePriceValue_9851c0eb_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__.n)(this.contractWrapper.getProvider(), listing.buyoutPricePerToken, resolvedCurrencyAddress);\n    let listingStartTime = Math.floor(listing.startTimestamp.getTime() / 1000);\n    const block = await this.contractWrapper.getProvider().getBlock(\"latest\");\n    const blockTime = block.timestamp;\n    if (listingStartTime < blockTime) {\n      listingStartTime = blockTime;\n    }\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"createListing\",\n      args: [{\n        assetContract: resolvedAssetAddress,\n        tokenId: listing.tokenId,\n        buyoutPricePerToken: normalizedPricePerToken,\n        currencyToAccept: (0,_cleanCurrencyAddress_ded19cfe_browser_esm_js__WEBPACK_IMPORTED_MODULE_13__.c)(resolvedCurrencyAddress),\n        listingType: _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Direct,\n        quantityToList: listing.quantity,\n        reservePricePerToken: normalizedPricePerToken,\n        secondsUntilEndTime: listing.listingDurationInSeconds,\n        startTime: ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingStartTime)\n      }],\n      parse: receipt => {\n        const event = this.contractWrapper.parseLogs(\"ListingAdded\", receipt?.logs);\n        return {\n          id: event[0].args.listingId,\n          receipt\n        };\n      }\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Create a batch of new listings\n   *\n   * @remarks Create a batch of new listings on the marketplace\n   *\n   * @example\n   * ```javascript\n   * const listings = [...];\n   * const tx = await contract.direct.createListingsBatch(listings);\n   * ```\n   */\n  createListingsBatch = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listings => {\n    const data = (await Promise.all(listings.map(listing => this.createListing.prepare(listing)))).map(tx => tx.encode());\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"multicall\",\n      args: [data],\n      parse: receipt => {\n        const events = this.contractWrapper.parseLogs(\"ListingAdded\", receipt?.logs);\n        return events.map(event => {\n          return {\n            id: event.args.listingId,\n            receipt\n          };\n        });\n      }\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Make an offer for a Direct Listing\n   *\n   * @remarks Make an offer on a direct listing\n   *\n   * @example\n   * ```javascript\n   * import { ChainId, NATIVE_TOKENS } from \"@thirdweb-dev/sdk\";\n   *\n   * // The listing ID of the asset you want to offer on\n   * const listingId = 0;\n   * // The price you are willing to offer per token\n   * const pricePerToken = 1;\n   * // The quantity of tokens you want to receive for this offer\n   * const quantity = 1;\n   * // The address of the currency you are making the offer in (must be ERC-20)\n   * const currencyContractAddress = NATIVE_TOKENS[ChainId.Rinkeby].wrapped.address\n   *\n   * await contract.direct.makeOffer(\n   *   listingId,\n   *   quantity,\n   *   currencyContractAddress,\n   *   pricePerToken\n   * );\n   * ```\n   */\n  makeOffer = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async (listingId, quantityDesired, currencyContractAddress, pricePerToken, expirationDate) => {\n    if ((0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.i)(currencyContractAddress)) {\n      throw new Error(\"You must use the wrapped native token address when making an offer with a native token\");\n    }\n    const normalizedPrice = await (0,_normalizePriceValue_9851c0eb_browser_esm_js__WEBPACK_IMPORTED_MODULE_12__.n)(this.contractWrapper.getProvider(), pricePerToken, currencyContractAddress);\n    try {\n      await this.getListing(listingId);\n    } catch (err) {\n      console.error(\"Failed to get listing, err =\", err);\n      throw new Error(`Error getting the listing with id ${listingId}`);\n    }\n    const quantity = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(quantityDesired);\n    const value = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(normalizedPrice).mul(quantity);\n    const overrides = (await this.contractWrapper.getCallOverrides()) || {};\n    await (0,_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_15__.s)(this.contractWrapper, value, currencyContractAddress, overrides);\n    let expirationTimestamp = ethers__WEBPACK_IMPORTED_MODULE_16__.MaxUint256;\n    if (expirationDate) {\n      expirationTimestamp = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(Math.floor(expirationDate.getTime() / 1000));\n    }\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"offer\",\n      args: [listingId, quantityDesired, currencyContractAddress, normalizedPrice, expirationTimestamp],\n      overrides\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Accept an offer on a direct listing\n   *\n   * @remarks Accept an offer on a direct listing\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to bid on\n   * const listingId = 0;\n   * // The price you are willing to bid for a single token of the listing\n   * const offeror = \"0x...\";\n   *\n   * await contract.direct.acceptOffer(listingId, offeror);\n   * ```\n   */\n  acceptOffer = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async (listingId, addressOfOfferor) => {\n    /**\n     * TODO:\n     * - Provide better error handling if offer is too low.\n     */\n    await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    const resolvedAddress = await (0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.aL)(addressOfOfferor);\n    const offer = await this.contractWrapper.read(\"offers\", [listingId, resolvedAddress]);\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"acceptOffer\",\n      args: [listingId, resolvedAddress, offer.currency, offer.pricePerToken]\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Buy a Listing\n   *\n   * @remarks Buy a specific direct listing from the marketplace.\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to buy\n   * const listingId = 0;\n   * // Quantity of the asset you want to buy\n   * const quantityDesired = 1;\n   *\n   * await contract.direct.buyoutListing(listingId, quantityDesired);\n   * ```\n   *\n   * @param listingId - The listing id to buy\n   * @param quantityDesired - the quantity to buy\n   * @param receiver - optional receiver of the bought listing if different from the connected wallet\n   */\n  buyoutListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async (listingId, quantityDesired, receiver) => {\n    const listing = await this.validateListing(ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId));\n    const {\n      valid,\n      error\n    } = await this.isStillValidListing(listing, quantityDesired);\n    if (!valid) {\n      throw new Error(`Listing ${listingId} is no longer valid. ${error}`);\n    }\n    const buyFor = receiver ? receiver : await this.contractWrapper.getSignerAddress();\n    const quantity = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(quantityDesired);\n    const value = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listing.buyoutPrice).mul(quantity);\n    const overrides = (await this.contractWrapper.getCallOverrides()) || {};\n    await (0,_setErc20Allowance_7f76f677_browser_esm_js__WEBPACK_IMPORTED_MODULE_15__.s)(this.contractWrapper, value, listing.currencyContractAddress, overrides);\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"buy\",\n      args: [listingId, buyFor, quantity, listing.currencyContractAddress, value],\n      overrides\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Update a Direct listing with new metadata.\n   *\n   * Note: cannot update a listing with a new quantity of 0. Use `cancelDirectListing` to remove a listing instead.\n   *\n   * @param listing - the new listing information\n   */\n  updateListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listing => {\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"updateListing\",\n      args: [listing.id, listing.quantity, listing.buyoutPrice,\n      // reserve price, doesn't matter for direct listing\n      listing.buyoutPrice, await (0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.aL)(listing.currencyContractAddress), listing.startTimeInSeconds, listing.secondsUntilEnd]\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /**\n   * Cancel Direct Listing\n   *\n   * @remarks Cancel a direct listing on the marketplace\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the direct listing you want to cancel\n   * const listingId = \"0\";\n   *\n   * await contract.direct.cancelListing(listingId);\n   * ```\n   */\n  cancelListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async listingId => {\n    const tx = _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"cancelDirectListing\",\n      args: [listingId]\n    });\n    tx.setGasLimitMultiple(1.2);\n    return tx;\n  });\n\n  /** ******************************\n   * PRIVATE FUNCTIONS\n   *******************************/\n\n  /**\n   * Throws error if listing could not be found\n   *\n   * @param listingId - Listing to check for\n   */\n  async validateListing(listingId) {\n    try {\n      return await this.getListing(listingId);\n    } catch (err) {\n      console.error(`Error getting the listing with id ${listingId}`);\n      throw err;\n    }\n  }\n\n  /**\n   * Helper method maps the auction listing to the direct listing interface.\n   *\n   * @internal\n   * @param listing - The listing to map, as returned from the contract.\n   * @returns  The mapped interface.\n   */\n  async mapListing(listing) {\n    return {\n      assetContractAddress: listing.assetContract,\n      buyoutPrice: ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listing.buyoutPricePerToken),\n      currencyContractAddress: listing.currency,\n      buyoutCurrencyValuePerToken: await (0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.a)(this.contractWrapper.getProvider(), listing.currency, listing.buyoutPricePerToken),\n      id: listing.listingId.toString(),\n      tokenId: listing.tokenId,\n      quantity: listing.quantity,\n      startTimeInSeconds: listing.startTime,\n      asset: await (0,_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_17__.c)(listing.assetContract, this.contractWrapper.getProvider(), listing.tokenId, this.storage),\n      secondsUntilEnd: listing.endTime,\n      sellerAddress: listing.tokenOwner,\n      type: _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Direct\n    };\n  }\n\n  /**\n   * Use this method to check if a direct listing is still valid.\n   *\n   * Ways a direct listing can become invalid:\n   * 1. The asset holder transferred the asset to another wallet\n   * 2. The asset holder burned the asset\n   * 3. The asset holder removed the approval on the marketplace\n   *\n   * @internal\n   * @param listing - The listing to check.\n   * @returns  True if the listing is valid, false otherwise.\n   */\n  async isStillValidListing(listing, quantity) {\n    const approved = await (0,_marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.i)(this.contractWrapper.getProvider(), this.getAddress(), listing.assetContractAddress, listing.tokenId, listing.sellerAddress);\n    if (!approved) {\n      return {\n        valid: false,\n        error: `Token '${listing.tokenId}' from contract '${listing.assetContractAddress}' is not approved for transfer`\n      };\n    }\n    const provider = this.contractWrapper.getProvider();\n    const ERC165Abi = (await __webpack_require__.e(/*! import() */ \"_app-pages-browser_node_modules_thirdweb-dev_contracts-js_dist_abis_IERC165_json\").then(__webpack_require__.t.bind(__webpack_require__, /*! @thirdweb-dev/contracts-js/dist/abis/IERC165.json */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC165.json\", 19))).default;\n    const erc165 = new ethers__WEBPACK_IMPORTED_MODULE_19__.Contract(listing.assetContractAddress, ERC165Abi, provider);\n    const isERC721 = await erc165.supportsInterface(_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_17__.I);\n    const isERC1155 = await erc165.supportsInterface(_QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_17__.a);\n    if (isERC721) {\n      const ERC721Abi = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! @thirdweb-dev/contracts-js/dist/abis/IERC721.json */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC721.json\", 19))).default;\n      const asset = new ethers__WEBPACK_IMPORTED_MODULE_19__.Contract(listing.assetContractAddress, ERC721Abi, provider);\n\n      // Handle reverts in case of non-existent tokens\n      let owner;\n      try {\n        owner = await asset.ownerOf(listing.tokenId);\n      } catch (e) {}\n      const valid = owner?.toLowerCase() === listing.sellerAddress.toLowerCase();\n      return {\n        valid,\n        error: valid ? undefined : `Seller is not the owner of Token '${listing.tokenId}' from contract '${listing.assetContractAddress} anymore'`\n      };\n    } else if (isERC1155) {\n      const ERC1155Abi = (await Promise.resolve(/*! import() */).then(__webpack_require__.t.bind(__webpack_require__, /*! @thirdweb-dev/contracts-js/dist/abis/IERC1155.json */ \"(app-pages-browser)/./node_modules/@thirdweb-dev/contracts-js/dist/abis/IERC1155.json\", 19))).default;\n      const asset = new ethers__WEBPACK_IMPORTED_MODULE_19__.Contract(listing.assetContractAddress, ERC1155Abi, provider);\n      const balance = await asset.balanceOf(listing.sellerAddress, listing.tokenId);\n      const valid = balance.gte(quantity || listing.quantity);\n      return {\n        valid,\n        error: valid ? undefined : `Seller does not have enough balance of Token '${listing.tokenId}' from contract '${listing.assetContractAddress} to fulfill the listing`\n      };\n    } else {\n      return {\n        valid: false,\n        error: \"Contract does not implement ERC 1155 or ERC 721.\"\n      };\n    }\n  }\n}\n\n/**\n * Create your own whitelabel marketplace that enables users to buy and sell any digital assets.\n *\n * @example\n *\n * ```javascript\n * import { ThirdwebSDK } from \"@thirdweb-dev/sdk\";\n *\n * const sdk = new ThirdwebSDK(\"{{chainName}}\");\n * const contract = await sdk.getContract(\"{{contract_address}}\", \"marketplace\");\n * ```\n *\n * @internal\n * @deprecated use contract.directListings / contract.auctions / contract.offers instead\n */\nclass Marketplace {\n  static contractRoles = _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.dH;\n\n  /**\n   * @internal\n   */\n\n  /**\n   * Direct listings\n   * @remarks Create and manage direct listings in your marketplace.\n   * @example\n   * ```javascript\n   * // Data of the listing you want to create\n   * const listing = {\n   *   // address of the NFT contract the asset you want to list is on\n   *   assetContractAddress: \"0x...\",\n   *   // token ID of the asset you want to list\n   *   tokenId: \"0\",\n   *  // when should the listing open up for offers\n   *   startTimestamp: new Date(),\n   *   // how long the listing will be open for\n   *   listingDurationInSeconds: 86400,\n   *   // how many of the asset you want to list\n   *   quantity: 1,\n   *   // address of the currency contract that will be used to pay for the listing\n   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,\n   *   // how much the asset will be sold for\n   *   buyoutPricePerToken: \"1.5\",\n   * }\n   *\n   * const tx = await contract.direct.createListing(listing);\n   * const receipt = tx.receipt; // the transaction receipt\n   * const listingId = tx.id; // the id of the newly created listing\n   *\n   * // And on the buyers side:\n   * // Quantity of the asset you want to buy\n   * const quantityDesired = 1;\n   * await contract.direct.buyoutListing(listingId, quantityDesired);\n   * ```\n   */\n\n  /**\n   * Auctions\n   * @remarks Create and manage auctions in your marketplace.\n   * @example\n   * ```javascript\n   * // Data of the auction you want to create\n   * const auction = {\n   *   // address of the contract the asset you want to list is on\n   *   assetContractAddress: \"0x...\",\n   *   // token ID of the asset you want to list\n   *   tokenId: \"0\",\n   *  // when should the listing open up for offers\n   *   startTimestamp: new Date(),\n   *   // how long the listing will be open for\n   *   listingDurationInSeconds: 86400,\n   *   // how many of the asset you want to list\n   *   quantity: 1,\n   *   // address of the currency contract that will be used to pay for the listing\n   *   currencyContractAddress: NATIVE_TOKEN_ADDRESS,\n   *   // how much people would have to bid to instantly buy the asset\n   *   buyoutPricePerToken: \"10\",\n   *   // the minimum bid that will be accepted for the token\n   *   reservePricePerToken: \"1.5\",\n   * }\n   *\n   * const tx = await contract.auction.createListing(auction);\n   * const receipt = tx.receipt; // the transaction receipt\n   * const listingId = tx.id; // the id of the newly created listing\n   *\n   * // And on the buyers side:\n   * // The price you are willing to bid for a single token of the listing\n   * const pricePerToken = 2.6;\n   * await contract.auction.makeBid(listingId, pricePerToken);\n   * ```\n   */\n\n  get chainId() {\n    return this._chainId;\n  }\n  constructor(network, address, storage) {\n    let options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n    let abi = arguments.length > 4 ? arguments[4] : undefined;\n    let chainId = arguments.length > 5 ? arguments[5] : undefined;\n    let contractWrapper = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.cs(network, address, abi, options, storage);\n    this._chainId = chainId;\n    this.abi = _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.bj.parse(abi || []);\n    this.contractWrapper = contractWrapper;\n    this.storage = storage;\n    this.metadata = new _contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_10__.C(this.contractWrapper, _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.b$, this.storage);\n    this.app = new _contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_10__.b(this.contractWrapper, this.metadata, this.storage);\n    this.roles = new _contract_roles_71988d2e_browser_esm_js__WEBPACK_IMPORTED_MODULE_20__.C(this.contractWrapper, Marketplace.contractRoles);\n    this.encoder = new _fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.C(this.contractWrapper);\n    this.estimator = new _contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_10__.G(this.contractWrapper);\n    this.direct = new MarketplaceDirect(this.contractWrapper, this.storage);\n    this.auction = new MarketplaceAuction(this.contractWrapper, this.storage);\n    this.events = new _contract_appuri_5c40af52_browser_esm_js__WEBPACK_IMPORTED_MODULE_10__.a(this.contractWrapper);\n    this.platformFees = new _contract_platform_fee_e756e68f_browser_esm_js__WEBPACK_IMPORTED_MODULE_21__.C(this.contractWrapper);\n    this.interceptor = new _contract_interceptor_d7b164a7_browser_esm_js__WEBPACK_IMPORTED_MODULE_22__.C(this.contractWrapper);\n  }\n  onNetworkUpdated(network) {\n    this.contractWrapper.updateSignerOrProvider(network);\n  }\n  getAddress() {\n    return this.contractWrapper.address;\n  }\n\n  /** ******************************\n   * READ FUNCTIONS\n   *******************************/\n\n  /**\n   * Convenience function to get either a direct or auction listing\n   *\n   * @param listingId - the listing id\n   * @returns either a direct or auction listing\n   *\n   * @remarks Get a listing by its listing id\n   * @example\n   * ```javascript\n   * const listingId = 0;\n   * const listing = await contract.getListing(listingId);\n   * ```\n   */\n  async getListing(listingId) {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.assetContract === ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero) {\n      throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.L(this.getAddress(), listingId.toString());\n    }\n    switch (listing.listingType) {\n      case _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Auction:\n        {\n          return await this.auction.mapListing(listing);\n        }\n      case _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Direct:\n        {\n          return await this.direct.mapListing(listing);\n        }\n      default:\n        {\n          throw new Error(`Unknown listing type: ${listing.listingType}`);\n        }\n    }\n  }\n\n  /**\n   * Get all active listings\n   *\n   * @remarks Fetch all the active listings from this marketplace contract. An active listing means it can be bought or bid on.\n   * @example\n   * ```javascript\n   * const listings = await contract.getActiveListings();\n   * const priceOfFirstActiveListing = listings[0].price;\n   * ```\n   * @param filter - optional filter parameters\n   */\n  async getActiveListings(filter) {\n    const rawListings = await this.getAllListingsNoFilter(true);\n    const filtered = this.applyFilter(rawListings, filter);\n    const now = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(Math.floor(Date.now() / 1000));\n    return filtered.filter(l => {\n      return l.type === _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Auction && ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(l.endTimeInEpochSeconds).gt(now) && ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(l.startTimeInEpochSeconds).lte(now) || l.type === _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Direct && ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(l.quantity).gt(0);\n    });\n  }\n\n  /**\n   * Get all the listings\n   *\n   * @remarks Fetch all the listings from this marketplace contract, including sold ones.\n   * @example\n   * ```javascript\n   * const listings = await contract.getAllListings();\n   * const priceOfFirstListing = listings[0].price;\n   * ```\n   *\n   * @param filter - optional filter parameters\n   */\n  async getAllListings(filter) {\n    const rawListings = await this.getAllListingsNoFilter(false);\n    return this.applyFilter(rawListings, filter);\n  }\n\n  /**\n   * @internal\n   */\n  getAll = this.getAllListings;\n\n  /**\n   * Get the total number of Listings\n   * @returns The total number listings on the marketplace\n   * @public\n   */\n  async getTotalCount() {\n    return await this.contractWrapper.read(\"totalListings\", []);\n  }\n\n  /**\n   * Get whether listing is restricted only to addresses with the Lister role\n   */\n  async isRestrictedToListerRoleOnly() {\n    const anyoneCanList = await this.contractWrapper.read(\"hasRole\", [(0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.H)(\"lister\"), ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero]);\n    return !anyoneCanList;\n  }\n\n  /**\n   * Get the buffer in basis points between offers\n   */\n  async getBidBufferBps() {\n    return this.contractWrapper.read(\"bidBufferBps\", []);\n  }\n\n  /**\n   * get the buffer time in seconds between offers\n   */\n  async getTimeBufferInSeconds() {\n    return this.contractWrapper.read(\"timeBuffer\", []);\n  }\n\n  /**\n   * Get all the offers for a listing\n   *\n   * @remarks Fetch all the offers for a specified direct or auction listing.\n   * @example\n   * ```javascript\n   * const offers = await marketplaceContract.getOffers(listingId);\n   * const firstOffer = offers[0];\n   * ```\n   *\n   * @param listingId - the id of the listing to fetch offers for\n   */\n  async getOffers(listingId) {\n    // get all new offer events from this contract\n    const listingEvents = await this.events.getEvents(\"NewOffer\", {\n      order: \"desc\",\n      filters: {\n        listingId\n      }\n    });\n    // derive the offers from the events\n    return await Promise.all(listingEvents.map(e => {\n      return (0,_marketplace_e3129e2f_browser_esm_js__WEBPACK_IMPORTED_MODULE_9__.m)(this.contractWrapper.getProvider(), ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(listingId), {\n        quantityWanted: e.data.quantityWanted,\n        pricePerToken: e.data.quantityWanted.gt(0) ? e.data.totalOfferAmount.div(e.data.quantityWanted) : e.data.totalOfferAmount,\n        currency: e.data.currency,\n        offeror: e.data.offeror\n      });\n    }));\n  }\n\n  /** ******************************\n   * WRITE FUNCTIONS\n   *******************************/\n\n  /**\n   * Purchase NFTs\n   * @remarks Buy a Direct or Auction listing on your marketplace.\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to buy\n   * const listingId = 0;\n   * // Quantity of the asset you want to buy\n   * const quantityDesired = 1;\n   *\n   * await contract.buyoutListing(listingId, quantityDesired);\n   * ```\n   * @param listingId - the listing ID of the listing you want to buy\n   * @param quantityDesired - the quantity that you want to buy (for ERC1155 tokens)\n   * @param receiver - optional receiver of the bought listing if different from the connected wallet (for direct listings only)\n   */\n  buyoutListing = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async (listingId, quantityDesired, receiver) => {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.listingId.toString() !== listingId.toString()) {\n      throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.L(this.getAddress(), listingId.toString());\n    }\n    switch (listing.listingType) {\n      case _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Direct:\n        {\n          (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(quantityDesired !== undefined, \"quantityDesired is required when buying out a direct listing\");\n          return await this.direct.buyoutListing.prepare(listingId, quantityDesired, receiver);\n        }\n      case _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Auction:\n        {\n          return await this.auction.buyoutListing.prepare(listingId);\n        }\n      default:\n        throw Error(`Unknown listing type: ${listing.listingType}`);\n    }\n  });\n\n  /**\n   * Make an offer for a Direct or Auction Listing\n   *\n   * @remarks Make an offer on a direct or auction listing\n   *\n   * @example\n   * ```javascript\n   * // The listing ID of the asset you want to offer on\n   * const listingId = 0;\n   * // The price you are willing to offer per token\n   * const pricePerToken = 0.5;\n   * // The quantity of tokens you want to receive for this offer\n   * const quantity = 1;\n   *\n   * await contract.makeOffer(\n   *   listingId,\n   *   pricePerToken,\n   *   quantity,\n   * );\n   * ```\n   */\n  makeOffer = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async (listingId, pricePerToken, quantity) => {\n    const listing = await this.contractWrapper.read(\"listings\", [listingId]);\n    if (listing.listingId.toString() !== listingId.toString()) {\n      throw new _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.L(this.getAddress(), listingId.toString());\n    }\n    const chainId = await this.contractWrapper.getChainID();\n    switch (listing.listingType) {\n      case _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Direct:\n        {\n          (0,tiny_invariant__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(quantity, \"quantity is required when making an offer on a direct listing\");\n          return await this.direct.makeOffer.prepare(listingId, quantity, (0,_fetchCurrencyValue_32d08b05_browser_esm_js__WEBPACK_IMPORTED_MODULE_4__.i)(listing.currency) ? _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.aW[chainId].wrapped.address : listing.currency, pricePerToken);\n        }\n      case _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Auction:\n        {\n          return await this.auction.makeBid.prepare(listingId, pricePerToken);\n        }\n      default:\n        throw Error(`Unknown listing type: ${listing.listingType}`);\n    }\n  });\n\n  /**\n   * Set the Auction bid buffer\n   * @remarks A percentage (e.g. 5%) in basis points (5% = 500, 100% = 10000). A new bid is considered to be a winning bid only if its bid amount is at least the bid buffer (e.g. 5%) greater than the previous winning bid. This prevents buyers from making very slightly higher bids to win the auctioned items.\n   * @example\n   * ```javascript\n   * // the bid buffer in basis points\n   * const bufferBps = 5_00; // 5%\n   * await contract.setBidBufferBps(bufferBps);\n   * ```\n   * @param bufferBps - the bps value\n   */\n  setBidBufferBps = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async bufferBps => {\n    await this.roles.verify([\"admin\"], await this.contractWrapper.getSignerAddress());\n    const timeBuffer = await this.getTimeBufferInSeconds();\n    return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"setAuctionBuffers\",\n      args: [timeBuffer, ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(bufferBps)]\n    });\n  });\n\n  /**\n   * Set the Auction Time buffer:\n   * @remarks Measured in seconds (e.g. 15 minutes or 900 seconds). If a winning bid is made within the buffer of the auction closing (e.g. 15 minutes within the auction closing), the auction's closing time is increased by the buffer to prevent buyers from making last minute winning bids, and to give time to other buyers to make a higher bid if they wish to.\n   * @example\n   * ```javascript\n   * // the time buffer in seconds\n   * const bufferInSeconds = 60;\n   * await contract.setTimeBufferInSeconds(bufferInSeconds);\n   * ```\n   * @param bufferInSeconds - the seconds value\n   */\n  setTimeBufferInSeconds = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async bufferInSeconds => {\n    await this.roles.verify([\"admin\"], await this.contractWrapper.getSignerAddress());\n    const bidBuffer = await this.getBidBufferBps();\n    return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"setAuctionBuffers\",\n      args: [ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(bufferInSeconds), bidBuffer]\n    });\n  });\n\n  /**\n   * Restrict listing NFTs only from the specified NFT contract address.\n   * It is possible to allow listing from multiple contract addresses.\n   * @param contractAddress - the NFT contract address\n   */\n  allowListingFromSpecificAssetOnly = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async contractAddress => {\n    const encoded = [];\n    const members = await this.roles.get(\"asset\");\n    if (members.includes(ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero)) {\n      encoded.push(this.encoder.encode(\"revokeRole\", [(0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.H)(\"asset\"), ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero]));\n    }\n    encoded.push(this.encoder.encode(\"grantRole\", [(0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.H)(\"asset\"), contractAddress]));\n    return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"multicall\",\n      args: [encoded]\n    });\n  });\n\n  /**\n   * Allow listings from any NFT contract\n   */\n  allowListingFromAnyAsset = /* @__PURE__ */(0,_transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.f)(async () => {\n    const encoded = [];\n    const members = await this.roles.get(\"asset\");\n    for (const addr in members) {\n      encoded.push(this.encoder.encode(\"revokeRole\", [(0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.H)(\"asset\"), addr]));\n    }\n    encoded.push(this.encoder.encode(\"grantRole\", [(0,_index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.H)(\"asset\"), ethers__WEBPACK_IMPORTED_MODULE_8__.AddressZero]));\n    return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method: \"multicall\",\n      args: [encoded]\n    });\n  });\n\n  /** ******************************\n   * PRIVATE FUNCTIONS\n   *******************************/\n\n  async getAllListingsNoFilter(filterInvalidListings) {\n    const listings = await Promise.all(Array.from(Array((await this.contractWrapper.read(\"totalListings\", [])).toNumber()).keys()).map(async i => {\n      let listing;\n      try {\n        listing = await this.getListing(i);\n      } catch (err) {\n        if (err instanceof _index_33cd3415_browser_esm_js__WEBPACK_IMPORTED_MODULE_5__.L) {\n          return undefined;\n        } else {\n          console.warn(`Failed to get listing ${i}' - skipping. Try 'marketplace.getListing(${i})' to get the underlying error.`);\n          return undefined;\n        }\n      }\n      if (listing.type === _ListingType_cba090cb_browser_esm_js__WEBPACK_IMPORTED_MODULE_6__.L.Auction) {\n        return listing;\n      }\n      if (filterInvalidListings) {\n        const {\n          valid\n        } = await this.direct.isStillValidListing(listing);\n        if (!valid) {\n          return undefined;\n        }\n      }\n      return listing;\n    }));\n    return listings.filter(l => l !== undefined);\n  }\n  applyFilter(listings, filter) {\n    let rawListings = [...listings];\n    const start = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(filter?.start || 0).toNumber();\n    const count = ethers__WEBPACK_IMPORTED_MODULE_7__.BigNumber.from(filter?.count || _QueryParams_32a56510_browser_esm_js__WEBPACK_IMPORTED_MODULE_17__.D).toNumber();\n    if (filter) {\n      if (filter.seller) {\n        rawListings = rawListings.filter(seller => seller.sellerAddress.toString().toLowerCase() === filter?.seller?.toString().toLowerCase());\n      }\n      if (filter.tokenContract) {\n        rawListings = rawListings.filter(tokenContract => tokenContract.assetContractAddress.toString().toLowerCase() === filter?.tokenContract?.toString().toLowerCase());\n      }\n      if (filter.tokenId !== undefined) {\n        rawListings = rawListings.filter(tokenContract => tokenContract.tokenId.toString() === filter?.tokenId?.toString());\n      }\n      rawListings = rawListings.filter((_, index) => index >= start);\n      rawListings = rawListings.slice(0, count);\n    }\n    return rawListings;\n  }\n\n  /**\n   * @internal\n   */\n  async prepare(method, args, overrides) {\n    return _transactions_72f9603c_browser_esm_js__WEBPACK_IMPORTED_MODULE_11__.T.fromContractWrapper({\n      contractWrapper: this.contractWrapper,\n      method,\n      args,\n      overrides\n    });\n  }\n\n  /**\n   * @internal\n   */\n  async call(functionName, args, overrides) {\n    return this.contractWrapper.call(functionName, args, overrides);\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwcC1wYWdlcy1icm93c2VyKS8uL25vZGVfbW9kdWxlcy9AdGhpcmR3ZWItZGV2L3Nkay9kaXN0L21hcmtldHBsYWNlLTJlMmFkYzBlLmJyb3dzZXIuZXNtLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQStEO0FBQ3hCO0FBQ3VJO0FBQ2pCO0FBQ2tMO0FBQzdKO0FBQ3pFO0FBQzBDO0FBQ3pEO0FBQ0M7QUFDYjtBQUNhO0FBQ0Y7QUFDSjtBQUNaO0FBQzVEO0FBQ2lCO0FBQ0E7QUFDZjtBQUNEO0FBQ29EO0FBQ1Q7QUFDUTtBQUNHO0FBQ0c7QUFDYjtBQUNNO0FBQ0U7QUFDSjtBQUNTO0FBQ0w7QUFDQztBQUNDO0FBQ0Y7QUFDQTtBQUNQO0FBQ1U7QUFDVztBQUNmO0FBQ0o7QUFDTTtBQUNLO0FBQ0c7QUFDSjtBQUNMO0FBQ0U7QUFDSjtBQUNBO0FBQ0c7QUFDQztBQUNDO0FBQ1I7QUFDTTtBQUNLO0FBQ0c7QUFDZjtBQUNRO0FBQ0Y7QUFDSTtBQUNGO0FBQ0s7QUFDTjtBQUNSO0FBQ1U7QUFDRjtBQUNDO0FBQ1Q7QUFDTztBQUNGO0FBQ1U7QUFDVjtBQUNBO0FBQ0o7QUFDRDtBQUNNO0FBQ0M7QUFDQztBQUNJO0FBQ0E7QUFDRztBQUNkO0FBQ2xDO0FBQ0g7QUFDUTs7QUFFL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QiwwRUFBZTtBQUN0QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDZEQUFvQjtBQUNwQztBQUNBLGdDQUFnQyxtRUFBVztBQUMzQyxnQkFBZ0IsNkRBQXFCO0FBQ3JDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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SztBQUNMLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLHlFQUF3QjtBQUNwRTtBQUNBO0FBQ0E7QUFDQSxzREFBc0QsaUVBQVc7QUFDakU7QUFDQSxtREFBbUQsaUVBQVcsV0FBVywrQ0FBcUI7QUFDOUYsV0FBVyxxRUFBVztBQUN0QjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUiwyQkFBMkIsNkRBQW9CO0FBQy9DO0FBQ0EsVUFBVTtBQUNWLGdEQUFnRCxFQUFFLDRDQUE0QyxFQUFFO0FBQ2hHO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixtRUFBVztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsNkNBQVM7QUFDM0Isa0JBQWtCLDZDQUFTLHVCQUF1QixvRUFBdUI7QUFDekU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxxRUFBVztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFdUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9fTl9FLy4vbm9kZV9tb2R1bGVzL0B0aGlyZHdlYi1kZXYvc2RrL2Rpc3QvbWFya2V0cGxhY2UtMmUyYWRjMGUuYnJvd3Nlci5lc20uanM/MGI3ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCaWdOdW1iZXIsIGNvbnN0YW50cywgdXRpbHMsIENvbnRyYWN0IH0gZnJvbSAnZXRoZXJzJztcbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAndGlueS1pbnZhcmlhbnQnO1xuaW1wb3J0IHsgYyBhcyBmZXRjaFRva2VuTWV0YWRhdGFGb3JDb250cmFjdCwgSSBhcyBJbnRlcmZhY2VJZF9JRVJDNzIxLCBhIGFzIEludGVyZmFjZUlkX0lFUkMxMTU1LCBEIGFzIERFRkFVTFRfUVVFUllfQUxMX0NPVU5UIH0gZnJvbSAnLi9RdWVyeVBhcmFtcy0zMmE1NjUxMC5icm93c2VyLmVzbS5qcyc7XG5pbXBvcnQgeyBDIGFzIENvbnRyYWN0RW5jb2RlciwgZiBhcyBmZXRjaEN1cnJlbmN5TWV0YWRhdGEsIGEgYXMgZmV0Y2hDdXJyZW5jeVZhbHVlLCBpIGFzIGlzTmF0aXZlVG9rZW4gfSBmcm9tICcuL2ZldGNoQ3VycmVuY3lWYWx1ZS0zMmQwOGIwNS5icm93c2VyLmVzbS5qcyc7XG5pbXBvcnQgeyBMIGFzIExpc3RpbmdOb3RGb3VuZEVycm9yLCBXIGFzIFdyb25nTGlzdGluZ1R5cGVFcnJvciwgYUwgYXMgcmVzb2x2ZUFkZHJlc3MsIHQgYXMgQXVjdGlvbkFscmVhZHlTdGFydGVkRXJyb3IsIHcgYXMgQXVjdGlvbkhhc05vdEVuZGVkRXJyb3IsIGRIIGFzIE1BUktFVFBMQUNFX0NPTlRSQUNUX1JPTEVTLCBjcyBhcyBDb250cmFjdFdyYXBwZXIsIGJqIGFzIEFiaVNjaGVtYSwgYiQgYXMgTWFya2V0cGxhY2VDb250cmFjdFNjaGVtYSwgSCBhcyBnZXRSb2xlSGFzaCwgYVcgYXMgTkFUSVZFX1RPS0VOUyB9IGZyb20gJy4vaW5kZXgtMzNjZDM0MTUuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0IHsgbSBhcyBtYXBPZmZlciwgdiBhcyB2YWxpZGF0ZU5ld0xpc3RpbmdQYXJhbSwgaCBhcyBoYW5kbGVUb2tlbkFwcHJvdmFsLCBhIGFzIGlzV2lubmluZ0JpZCwgaSBhcyBpc1Rva2VuQXBwcm92ZWRGb3JUcmFuc2ZlciB9IGZyb20gJy4vbWFya2V0cGxhY2UtZTMxMjllMmYuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0IHsgZiBhcyBidWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24sIFQgYXMgVHJhbnNhY3Rpb24gfSBmcm9tICcuL3RyYW5zYWN0aW9ucy03MmY5NjAzYy5icm93c2VyLmVzbS5qcyc7XG5pbXBvcnQgeyBhIGFzIENvbnRyYWN0RXZlbnRzLCBDIGFzIENvbnRyYWN0TWV0YWRhdGEsIGIgYXMgQ29udHJhY3RBcHBVUkksIEcgYXMgR2FzQ29zdEVzdGltYXRvciB9IGZyb20gJy4vY29udHJhY3QtYXBwdXJpLTVjNDBhZjUyLmJyb3dzZXIuZXNtLmpzJztcbmltcG9ydCB7IEMgYXMgQ29udHJhY3RJbnRlcmNlcHRvciB9IGZyb20gJy4vY29udHJhY3QtaW50ZXJjZXB0b3ItZDdiMTY0YTcuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0IHsgQyBhcyBDb250cmFjdFBsYXRmb3JtRmVlIH0gZnJvbSAnLi9jb250cmFjdC1wbGF0Zm9ybS1mZWUtZTc1NmU2OGYuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0IHsgQyBhcyBDb250cmFjdFJvbGVzIH0gZnJvbSAnLi9jb250cmFjdC1yb2xlcy03MTk4OGQyZS5icm93c2VyLmVzbS5qcyc7XG5pbXBvcnQgeyBjIGFzIGNsZWFuQ3VycmVuY3lBZGRyZXNzIH0gZnJvbSAnLi9jbGVhbkN1cnJlbmN5QWRkcmVzcy1kZWQxOWNmZS5icm93c2VyLmVzbS5qcyc7XG5pbXBvcnQgeyBuIGFzIG5vcm1hbGl6ZVByaWNlVmFsdWUgfSBmcm9tICcuL25vcm1hbGl6ZVByaWNlVmFsdWUtOTg1MWMwZWIuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0IHsgcyBhcyBzZXRFcmMyMEFsbG93YW5jZSB9IGZyb20gJy4vc2V0RXJjMjBBbGxvd2FuY2UtN2Y3NmY2NzcuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0IHsgTCBhcyBMaXN0aW5nVHlwZSB9IGZyb20gJy4vTGlzdGluZ1R5cGUtY2JhMDkwY2IuYnJvd3Nlci5lc20uanMnO1xuaW1wb3J0ICd6b2QnO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NoYWlucyc7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY3J5cHRvJztcbmltcG9ydCAnYm4uanMnO1xuaW1wb3J0ICdiczU4JztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lCdXJuYWJsZUVSQzIwLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURyb3AuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcEVSQzIwX1YyLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURyb3BTaW5nbGVQaGFzZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEcm9wU2luZ2xlUGhhc2VfVjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMjAuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMjBQZXJtaXQuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTWludGFibGVFUkMyMC5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lNdWx0aWNhbGwuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JU2lnbmF0dXJlTWludEVSQzIwLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzIwTWV0YWRhdGEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQnVybmFibGVFUkM3MjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQ2xhaW1hYmxlRVJDNzIxLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURlbGF5ZWRSZXZlYWwuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcEVSQzcyMV9WMy5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lFUkM3MjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDNzIxRW51bWVyYWJsZS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lFUkM3MjFBUXVlcnlhYmxlVXBncmFkZWFibGUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDNzIxU3VwcGx5Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUxhenlNaW50Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSU1pbnRhYmxlRVJDNzIxLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVNpZ25hdHVyZU1pbnRFUkM3MjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JU2lnbmF0dXJlTWludEVSQzcyMV9WMS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0xhenlNaW50V2l0aFRpZXJfVjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9TaGFyZWRNZXRhZGF0YS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL3pvcmFfSUVSQzcyMURyb3AuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTG95YWx0eUNhcmQuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTkZUTWV0YWRhdGEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDNzIxTWV0YWRhdGEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQnVybmFibGVFUkMxMTU1Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUNsYWltYWJsZUVSQzExNTUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcDExNTUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcEVSQzExNTVfVjIuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRHJvcFNpbmdsZVBoYXNlMTE1NS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lEcm9wU2luZ2xlUGhhc2UxMTU1X1YxLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzExNTUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMTE1NU1ldGFkYXRhLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzExNTVTdXBwbHkuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JRVJDMTE1NUVudW1lcmFibGUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JTWludGFibGVFUkMxMTU1Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSVNpZ25hdHVyZU1pbnRFUkMxMTU1Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVSQzI3NzFDb250ZXh0Lmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUFwcFVSSS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lDb250cmFjdE1ldGFkYXRhLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSURpcmVjdExpc3RpbmdzLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUVuZ2xpc2hBdWN0aW9ucy5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lPZmZlcnMuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JUGFja1ZSRkRpcmVjdC5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lQZXJtaXNzaW9ucy5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lQZXJtaXNzaW9uc0VudW1lcmFibGUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JUGxhdGZvcm1GZWUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JUHJpbWFyeVNhbGUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JUm95YWx0eS5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL093bmFibGUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQWlyZHJvcEVSQzIwLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUFpcmRyb3BFUkM3MjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQWlyZHJvcEVSQzExNTUuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQWNjb3VudEZhY3RvcnlDb3JlLmpzb24nO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L2NvbnRyYWN0cy1qcy9kaXN0L2FiaXMvSUFjY291bnRQZXJtaXNzaW9ucy5qc29uJztcbmltcG9ydCAnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lBY2NvdW50UGVybWlzc2lvbnNfVjEuanNvbic7XG5pbXBvcnQgJ0B0aGlyZHdlYi1kZXYvY29udHJhY3RzLWpzL2Rpc3QvYWJpcy9JQWNjb3VudC5qc29uJztcbmltcG9ydCAnZXRoZXJzL2xpYi91dGlscyc7XG5pbXBvcnQgJ2V2ZW50ZW1pdHRlcjMnO1xuaW1wb3J0ICdAdGhpcmR3ZWItZGV2L3N0b3JhZ2UnO1xuXG4vKipcbiAqIEhhbmRsZXMgYXVjdGlvbiBsaXN0aW5nc1xuICogQHB1YmxpY1xuICovXG5jbGFzcyBNYXJrZXRwbGFjZUF1Y3Rpb24ge1xuICBjb25zdHJ1Y3Rvcihjb250cmFjdFdyYXBwZXIsIHN0b3JhZ2UpIHtcbiAgICB0aGlzLmNvbnRyYWN0V3JhcHBlciA9IGNvbnRyYWN0V3JhcHBlcjtcbiAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMuZW5jb2RlciA9IG5ldyBDb250cmFjdEVuY29kZXIoY29udHJhY3RXcmFwcGVyKTtcbiAgfVxuICBnZXRBZGRyZXNzKCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRyYWN0V3JhcHBlci5hZGRyZXNzO1xuICB9XG5cbiAgLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBSRUFEIEZVTkNUSU9OU1xuICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICAvKipcbiAgICogR2V0IGFuIEF1Y3Rpb24gbGlzdGluZyBieSBpZFxuICAgKlxuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gdGhlIGxpc3RpbmcgSWRcbiAgICogQHJldHVybnMgVGhlIEF1Y3Rpb24gbGlzdGluZyBvYmplY3RcbiAgICovXG4gIGFzeW5jIGdldExpc3RpbmcobGlzdGluZ0lkKSB7XG4gICAgY29uc3QgbGlzdGluZyA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWQoXCJsaXN0aW5nc1wiLCBbbGlzdGluZ0lkXSk7XG4gICAgaWYgKGxpc3RpbmcubGlzdGluZ0lkLnRvU3RyaW5nKCkgIT09IGxpc3RpbmdJZC50b1N0cmluZygpKSB7XG4gICAgICB0aHJvdyBuZXcgTGlzdGluZ05vdEZvdW5kRXJyb3IodGhpcy5nZXRBZGRyZXNzKCksIGxpc3RpbmdJZC50b1N0cmluZygpKTtcbiAgICB9XG4gICAgaWYgKGxpc3RpbmcubGlzdGluZ1R5cGUgIT09IExpc3RpbmdUeXBlLkF1Y3Rpb24pIHtcbiAgICAgIHRocm93IG5ldyBXcm9uZ0xpc3RpbmdUeXBlRXJyb3IodGhpcy5nZXRBZGRyZXNzKCksIGxpc3RpbmdJZC50b1N0cmluZygpLCBcIkRpcmVjdFwiLCBcIkF1Y3Rpb25cIik7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLm1hcExpc3RpbmcobGlzdGluZyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IEhpZ2hlc3QgQmlkXG4gICAqXG4gICAqIEByZW1hcmtzIEdldCB0aGUgY3VycmVudCBoaWdoZXN0IGJpZCBvZiBhbiBhY3RpdmUgYXVjdGlvbi5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBUaGUgbGlzdGluZyBJRCBvZiB0aGUgYXVjdGlvbiB0aGF0IGNsb3NlZFxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSAwO1xuICAgKlxuICAgKiBjb250cmFjdC5hdWN0aW9uLlxuICAgKiAgIC5nZXRXaW5uaW5nQmlkKGxpc3RpbmdJZClcbiAgICogICAudGhlbigob2ZmZXIpID0+IGNvbnNvbGUubG9nKG9mZmVyKSlcbiAgICogICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcbiAgICogYGBgXG4gICAqL1xuICBhc3luYyBnZXRXaW5uaW5nQmlkKGxpc3RpbmdJZCkge1xuICAgIGF3YWl0IHRoaXMudmFsaWRhdGVMaXN0aW5nKEJpZ051bWJlci5mcm9tKGxpc3RpbmdJZCkpO1xuICAgIGNvbnN0IG9mZmVycyA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWQoXCJ3aW5uaW5nQmlkXCIsIFtsaXN0aW5nSWRdKTtcbiAgICBpZiAob2ZmZXJzLm9mZmVyb3IgPT09IGNvbnN0YW50cy5BZGRyZXNzWmVybykge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IG1hcE9mZmVyKHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCksIEJpZ051bWJlci5mcm9tKGxpc3RpbmdJZCksIG9mZmVycyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IEF1Y3Rpb24gV2lubmVyXG4gICAqXG4gICAqIEByZW1hcmtzIEdldCB0aGUgd2lubmVyIG9mIHRoZSBhdWN0aW9uIGFmdGVyIGFuIGF1Y3Rpb24gZW5kcy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBUaGUgbGlzdGluZyBJRCBvZiB0aGUgYXVjdGlvbiB0aGF0IGNsb3NlZFxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSAwO1xuICAgKlxuICAgKiBjb250cmFjdC5hdWN0aW9uLlxuICAgKiAgIC5nZXRXaW5uZXIobGlzdGluZ0lkKVxuICAgKiAgIC50aGVuKChhdWN0aW9uV2lubmVyKSA9PiBjb25zb2xlLmxvZyhhdWN0aW9uV2lubmVyKSlcbiAgICogICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcbiAgICogYGBgXG4gICAqL1xuICBhc3luYyBnZXRXaW5uZXIobGlzdGluZ0lkKSB7XG4gICAgY29uc3QgbGlzdGluZyA9IGF3YWl0IHRoaXMudmFsaWRhdGVMaXN0aW5nKEJpZ051bWJlci5mcm9tKGxpc3RpbmdJZCkpO1xuICAgIGNvbnN0IG9mZmVycyA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWQoXCJ3aW5uaW5nQmlkXCIsIFtsaXN0aW5nSWRdKTtcbiAgICBjb25zdCBub3cgPSBCaWdOdW1iZXIuZnJvbShNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSk7XG4gICAgY29uc3QgZW5kVGltZSA9IEJpZ051bWJlci5mcm9tKGxpc3RpbmcuZW5kVGltZUluRXBvY2hTZWNvbmRzKTtcblxuICAgIC8vIGlmIHdlIGhhdmUgYSB3aW5uZXIgaW4gdGhlIG1hcCBhbmQgdGhlIGN1cnJlbnQgdGltZSBpcyBwYXN0IHRoZSBlbmR0aW1lIG9mIHRoZSBhdWN0aW9uIHJldHVybiB0aGUgYWRkcmVzcyBvZiB0aGUgd2lubmVyXG4gICAgaWYgKG5vdy5ndChlbmRUaW1lKSAmJiBvZmZlcnMub2ZmZXJvciAhPT0gY29uc3RhbnRzLkFkZHJlc3NaZXJvKSB7XG4gICAgICByZXR1cm4gb2ZmZXJzLm9mZmVyb3I7XG4gICAgfVxuICAgIC8vIG90aGVyd2lzZSBmYWxsIGJhY2sgdG8gcXVlcnkgZmlsdGVyIHRoaW5nc1xuXG4gICAgLy8gVE9ETyB0aGlzIHNob3VsZCBiZSB2aWEgaW5kZXhlciBvciBkaXJlY3QgY29udHJhY3QgY2FsbFxuICAgIGNvbnN0IGNvbnRyYWN0RXZlbnRzID0gbmV3IENvbnRyYWN0RXZlbnRzKHRoaXMuY29udHJhY3RXcmFwcGVyKTtcbiAgICBjb25zdCBjbG9zZWRBdWN0aW9ucyA9IGF3YWl0IGNvbnRyYWN0RXZlbnRzLmdldEV2ZW50cyhcIkF1Y3Rpb25DbG9zZWRcIik7XG4gICAgY29uc3QgYXVjdGlvbiA9IGNsb3NlZEF1Y3Rpb25zLmZpbmQoYSA9PiBhLmRhdGEubGlzdGluZ0lkLmVxKEJpZ051bWJlci5mcm9tKGxpc3RpbmdJZCkpKTtcbiAgICBpZiAoIWF1Y3Rpb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgYXVjdGlvbiB3aXRoIGxpc3RpbmdJZCAke2xpc3RpbmdJZH0gaW4gY2xvc2VkIGF1Y3Rpb25zYCk7XG4gICAgfVxuICAgIHJldHVybiBhdWN0aW9uLmRhdGEud2lubmluZ0JpZGRlcjtcbiAgfVxuXG4gIC8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICogV1JJVEUgRlVOQ1RJT05TXG4gICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgQXVjdGlvblxuICAgKlxuICAgKiBAcmVtYXJrcyBDcmVhdGUgYSBuZXcgYXVjdGlvbiB3aGVyZSBwZW9wbGUgY2FuIGJpZCBvbiBhbiBhc3NldC5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBEYXRhIG9mIHRoZSBhdWN0aW9uIHlvdSB3YW50IHRvIGNyZWF0ZVxuICAgKiBjb25zdCBhdWN0aW9uID0ge1xuICAgKiAgIC8vIGFkZHJlc3Mgb2YgdGhlIGNvbnRyYWN0IHRoZSBhc3NldCB5b3Ugd2FudCB0byBsaXN0IGlzIG9uXG4gICAqICAgYXNzZXRDb250cmFjdEFkZHJlc3M6IFwiMHguLi5cIixcbiAgICogICAvLyB0b2tlbiBJRCBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gbGlzdFxuICAgKiAgIHRva2VuSWQ6IFwiMFwiLFxuICAgKiAgLy8gd2hlbiBzaG91bGQgdGhlIGxpc3Rpbmcgb3BlbiB1cCBmb3Igb2ZmZXJzXG4gICAqICAgc3RhcnRUaW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAqICAgLy8gaG93IGxvbmcgdGhlIGxpc3Rpbmcgd2lsbCBiZSBvcGVuIGZvclxuICAgKiAgIGxpc3RpbmdEdXJhdGlvbkluU2Vjb25kczogODY0MDAsXG4gICAqICAgLy8gaG93IG1hbnkgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGxpc3RcbiAgICogICBxdWFudGl0eTogMSxcbiAgICogICAvLyBhZGRyZXNzIG9mIHRoZSBjdXJyZW5jeSBjb250cmFjdCB0aGF0IHdpbGwgYmUgdXNlZCB0byBwYXkgZm9yIHRoZSBsaXN0aW5nXG4gICAqICAgY3VycmVuY3lDb250cmFjdEFkZHJlc3M6IE5BVElWRV9UT0tFTl9BRERSRVNTLFxuICAgKiAgIC8vIGhvdyBtdWNoIHBlb3BsZSB3b3VsZCBoYXZlIHRvIGJpZCB0byBpbnN0YW50bHkgYnV5IHRoZSBhc3NldFxuICAgKiAgIGJ1eW91dFByaWNlUGVyVG9rZW46IFwiMTBcIixcbiAgICogICAvLyB0aGUgbWluaW11bSBiaWQgdGhhdCB3aWxsIGJlIGFjY2VwdGVkIGZvciB0aGUgdG9rZW5cbiAgICogICByZXNlcnZlUHJpY2VQZXJUb2tlbjogXCIxLjVcIixcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0LmF1Y3Rpb24uY3JlYXRlTGlzdGluZyhhdWN0aW9uKTtcbiAgICogY29uc3QgcmVjZWlwdCA9IHR4LnJlY2VpcHQ7IC8vIHRoZSB0cmFuc2FjdGlvbiByZWNlaXB0XG4gICAqIGNvbnN0IGlkID0gdHguaWQ7IC8vIHRoZSBpZCBvZiB0aGUgbmV3bHkgY3JlYXRlZCBsaXN0aW5nXG4gICAqIGBgYFxuICAgKi9cbiAgY3JlYXRlTGlzdGluZyA9IC8qIEBfX1BVUkVfXyAqL2J1aWxkVHJhbnNhY3Rpb25GdW5jdGlvbihhc3luYyBsaXN0aW5nID0+IHtcbiAgICB2YWxpZGF0ZU5ld0xpc3RpbmdQYXJhbShsaXN0aW5nKTtcbiAgICBjb25zdCByZXNvbHZlZEFzc2V0QWRkcmVzcyA9IGF3YWl0IHJlc29sdmVBZGRyZXNzKGxpc3RpbmcuYXNzZXRDb250cmFjdEFkZHJlc3MpO1xuICAgIGNvbnN0IHJlc29sdmVkQ3VycmVuY3lBZGRyZXNzID0gYXdhaXQgcmVzb2x2ZUFkZHJlc3MobGlzdGluZy5jdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyk7XG4gICAgYXdhaXQgaGFuZGxlVG9rZW5BcHByb3ZhbCh0aGlzLmNvbnRyYWN0V3JhcHBlciwgdGhpcy5nZXRBZGRyZXNzKCksIHJlc29sdmVkQXNzZXRBZGRyZXNzLCBsaXN0aW5nLnRva2VuSWQsIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFNpZ25lckFkZHJlc3MoKSk7XG4gICAgY29uc3Qgbm9ybWFsaXplZFByaWNlUGVyVG9rZW4gPSBhd2FpdCBub3JtYWxpemVQcmljZVZhbHVlKHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCksIGxpc3RpbmcuYnV5b3V0UHJpY2VQZXJUb2tlbiwgcmVzb2x2ZWRDdXJyZW5jeUFkZHJlc3MpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRSZXNlcnZlUHJpY2UgPSBhd2FpdCBub3JtYWxpemVQcmljZVZhbHVlKHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCksIGxpc3RpbmcucmVzZXJ2ZVByaWNlUGVyVG9rZW4sIHJlc29sdmVkQ3VycmVuY3lBZGRyZXNzKTtcbiAgICBsZXQgbGlzdGluZ1N0YXJ0VGltZSA9IE1hdGguZmxvb3IobGlzdGluZy5zdGFydFRpbWVzdGFtcC5nZXRUaW1lKCkgLyAxMDAwKTtcbiAgICBjb25zdCBibG9jayA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCkuZ2V0QmxvY2soXCJsYXRlc3RcIik7XG4gICAgY29uc3QgYmxvY2tUaW1lID0gYmxvY2sudGltZXN0YW1wO1xuICAgIGlmIChsaXN0aW5nU3RhcnRUaW1lIDwgYmxvY2tUaW1lKSB7XG4gICAgICBsaXN0aW5nU3RhcnRUaW1lID0gYmxvY2tUaW1lO1xuICAgIH1cbiAgICBjb25zdCB0eCA9IFRyYW5zYWN0aW9uLmZyb21Db250cmFjdFdyYXBwZXIoe1xuICAgICAgY29udHJhY3RXcmFwcGVyOiB0aGlzLmNvbnRyYWN0V3JhcHBlcixcbiAgICAgIG1ldGhvZDogXCJjcmVhdGVMaXN0aW5nXCIsXG4gICAgICBhcmdzOiBbe1xuICAgICAgICBhc3NldENvbnRyYWN0OiByZXNvbHZlZEFzc2V0QWRkcmVzcyxcbiAgICAgICAgdG9rZW5JZDogbGlzdGluZy50b2tlbklkLFxuICAgICAgICBidXlvdXRQcmljZVBlclRva2VuOiBub3JtYWxpemVkUHJpY2VQZXJUb2tlbixcbiAgICAgICAgY3VycmVuY3lUb0FjY2VwdDogY2xlYW5DdXJyZW5jeUFkZHJlc3MocmVzb2x2ZWRDdXJyZW5jeUFkZHJlc3MpLFxuICAgICAgICBsaXN0aW5nVHlwZTogTGlzdGluZ1R5cGUuQXVjdGlvbixcbiAgICAgICAgcXVhbnRpdHlUb0xpc3Q6IGxpc3RpbmcucXVhbnRpdHksXG4gICAgICAgIHJlc2VydmVQcmljZVBlclRva2VuOiBub3JtYWxpemVkUmVzZXJ2ZVByaWNlLFxuICAgICAgICBzZWNvbmRzVW50aWxFbmRUaW1lOiBsaXN0aW5nLmxpc3RpbmdEdXJhdGlvbkluU2Vjb25kcyxcbiAgICAgICAgc3RhcnRUaW1lOiBCaWdOdW1iZXIuZnJvbShsaXN0aW5nU3RhcnRUaW1lKVxuICAgICAgfV0sXG4gICAgICBwYXJzZTogcmVjZWlwdCA9PiB7XG4gICAgICAgIGNvbnN0IGV2ZW50ID0gdGhpcy5jb250cmFjdFdyYXBwZXIucGFyc2VMb2dzKFwiTGlzdGluZ0FkZGVkXCIsIHJlY2VpcHQ/LmxvZ3MpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlkOiBldmVudFswXS5hcmdzLmxpc3RpbmdJZCxcbiAgICAgICAgICByZWNlaXB0XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSk7XG4gICAgdHguc2V0R2FzTGltaXRNdWx0aXBsZSgxLjIpO1xuICAgIHJldHVybiB0eDtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIGJhdGNoIG9mIG5ldyBhdWN0aW9uc1xuICAgKlxuICAgKiBAcmVtYXJrcyBDcmVhdGUgYSBiYXRjaCBvZiBuZXcgYXVjdGlvbnMgb24gdGhlIG1hcmtldHBsYWNlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogY29uc3QgYXVjdGlvbnMgPSBbLi4uXTtcbiAgICogY29uc3QgdHggPSBhd2FpdCBjb250cmFjdC5hdWN0aW9uLmNyZWF0ZUxpc3RpbmdzQmF0Y2goYXVjdGlvbnMpO1xuICAgKiBgYGBcbiAgICovXG4gIGNyZWF0ZUxpc3RpbmdzQmF0Y2ggPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgbGlzdGluZ3MgPT4ge1xuICAgIGNvbnN0IGRhdGEgPSAoYXdhaXQgUHJvbWlzZS5hbGwobGlzdGluZ3MubWFwKGxpc3RpbmcgPT4gdGhpcy5jcmVhdGVMaXN0aW5nLnByZXBhcmUobGlzdGluZykpKSkubWFwKHR4ID0+IHR4LmVuY29kZSgpKTtcbiAgICBjb25zdCB0eCA9IFRyYW5zYWN0aW9uLmZyb21Db250cmFjdFdyYXBwZXIoe1xuICAgICAgY29udHJhY3RXcmFwcGVyOiB0aGlzLmNvbnRyYWN0V3JhcHBlcixcbiAgICAgIG1ldGhvZDogXCJtdWx0aWNhbGxcIixcbiAgICAgIGFyZ3M6IFtkYXRhXSxcbiAgICAgIHBhcnNlOiByZWNlaXB0ID0+IHtcbiAgICAgICAgY29uc3QgZXZlbnRzID0gdGhpcy5jb250cmFjdFdyYXBwZXIucGFyc2VMb2dzKFwiTGlzdGluZ0FkZGVkXCIsIHJlY2VpcHQ/LmxvZ3MpO1xuICAgICAgICByZXR1cm4gZXZlbnRzLm1hcChldmVudCA9PiB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBldmVudC5hcmdzLmxpc3RpbmdJZCxcbiAgICAgICAgICAgIHJlY2VpcHRcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0eC5zZXRHYXNMaW1pdE11bHRpcGxlKDEuMik7XG4gICAgcmV0dXJuIHR4O1xuICB9KTtcblxuICAvKipcbiAgICogQnV5b3V0IEF1Y3Rpb25cbiAgICpcbiAgICogQHJlbWFya3MgQnV5IGEgc3BlY2lmaWMgZGlyZWN0IGxpc3RpbmcgZnJvbSB0aGUgbWFya2V0cGxhY2UuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGxpc3RpbmcgSUQgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGJ1eVxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSAwO1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5hdWN0aW9uLmJ1eW91dExpc3RpbmcobGlzdGluZ0lkKTtcbiAgICogYGBgXG4gICAqL1xuICBidXlvdXRMaXN0aW5nID0gLyogQF9fUFVSRV9fICovYnVpbGRUcmFuc2FjdGlvbkZ1bmN0aW9uKGFzeW5jIGxpc3RpbmdJZCA9PiB7XG4gICAgY29uc3QgbGlzdGluZyA9IGF3YWl0IHRoaXMudmFsaWRhdGVMaXN0aW5nKEJpZ051bWJlci5mcm9tKGxpc3RpbmdJZCkpO1xuICAgIGNvbnN0IGN1cnJlbmN5TWV0YWRhdGEgPSBhd2FpdCBmZXRjaEN1cnJlbmN5TWV0YWRhdGEodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgbGlzdGluZy5jdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyk7XG4gICAgcmV0dXJuIHRoaXMubWFrZUJpZC5wcmVwYXJlKGxpc3RpbmdJZCwgdXRpbHMuZm9ybWF0VW5pdHMobGlzdGluZy5idXlvdXRQcmljZSwgY3VycmVuY3lNZXRhZGF0YS5kZWNpbWFscykpO1xuICB9KTtcblxuICAvKipcbiAgICogQmlkIE9uIEF1Y3Rpb25cbiAgICpcbiAgICogQHJlbWFya3MgTWFrZSBhIGJpZCBvbiBhbiBhdWN0aW9uIGxpc3RpbmdcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBUaGUgbGlzdGluZyBJRCBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gYmlkIG9uXG4gICAqIGNvbnN0IGxpc3RpbmdJZCA9IDA7XG4gICAqIC8vIFRoZSBwcmljZSB5b3UgYXJlIHdpbGxpbmcgdG8gYmlkIGZvciBhIHNpbmdsZSB0b2tlbiBvZiB0aGUgbGlzdGluZ1xuICAgKiBjb25zdCBwcmljZVBlclRva2VuID0gMTtcbiAgICpcbiAgICogYXdhaXQgY29udHJhY3QuYXVjdGlvbi5tYWtlQmlkKGxpc3RpbmdJZCwgcHJpY2VQZXJUb2tlbik7XG4gICAqIGBgYFxuICAgKi9cbiAgbWFrZUJpZCA9IC8qIEBfX1BVUkVfXyAqL2J1aWxkVHJhbnNhY3Rpb25GdW5jdGlvbihhc3luYyAobGlzdGluZ0lkLCBwcmljZVBlclRva2VuKSA9PiB7XG4gICAgY29uc3QgbGlzdGluZyA9IGF3YWl0IHRoaXMudmFsaWRhdGVMaXN0aW5nKEJpZ051bWJlci5mcm9tKGxpc3RpbmdJZCkpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRQcmljZSA9IGF3YWl0IG5vcm1hbGl6ZVByaWNlVmFsdWUodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgcHJpY2VQZXJUb2tlbiwgbGlzdGluZy5jdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyk7XG4gICAgaWYgKG5vcm1hbGl6ZWRQcmljZS5lcShCaWdOdW1iZXIuZnJvbSgwKSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBtYWtlIGEgYmlkIHdpdGggMCB2YWx1ZVwiKTtcbiAgICB9XG4gICAgY29uc3QgYmlkQnVmZmVyID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZChcImJpZEJ1ZmZlckJwc1wiLCBbXSk7XG4gICAgY29uc3Qgd2lubmluZ0JpZCA9IGF3YWl0IHRoaXMuZ2V0V2lubmluZ0JpZChsaXN0aW5nSWQpO1xuICAgIGlmICh3aW5uaW5nQmlkKSB7XG4gICAgICBjb25zdCBpc1dpbm5lciA9IGlzV2lubmluZ0JpZCh3aW5uaW5nQmlkLnByaWNlUGVyVG9rZW4sIG5vcm1hbGl6ZWRQcmljZSwgYmlkQnVmZmVyKTtcbiAgICAgIGludmFyaWFudChpc1dpbm5lciwgXCJCaWQgcHJpY2UgaXMgdG9vIGxvdyBiYXNlZCBvbiB0aGUgY3VycmVudCB3aW5uaW5nIGJpZCBhbmQgdGhlIGJpZCBidWZmZXJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHRva2VuUHJpY2UgPSBub3JtYWxpemVkUHJpY2U7XG4gICAgICBjb25zdCByZXNlcnZlUHJpY2UgPSBCaWdOdW1iZXIuZnJvbShsaXN0aW5nLnJlc2VydmVQcmljZSk7XG4gICAgICBpbnZhcmlhbnQodG9rZW5QcmljZS5ndGUocmVzZXJ2ZVByaWNlKSwgXCJCaWQgcHJpY2UgaXMgdG9vIGxvdyBiYXNlZCBvbiByZXNlcnZlIHByaWNlXCIpO1xuICAgIH1cbiAgICBjb25zdCBxdWFudGl0eSA9IEJpZ051bWJlci5mcm9tKGxpc3RpbmcucXVhbnRpdHkpO1xuICAgIGNvbnN0IHZhbHVlID0gbm9ybWFsaXplZFByaWNlLm11bChxdWFudGl0eSk7XG4gICAgY29uc3Qgb3ZlcnJpZGVzID0gKGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldENhbGxPdmVycmlkZXMoKSkgfHwge307XG4gICAgYXdhaXQgc2V0RXJjMjBBbGxvd2FuY2UodGhpcy5jb250cmFjdFdyYXBwZXIsIHZhbHVlLCBsaXN0aW5nLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzLCBvdmVycmlkZXMpO1xuICAgIGNvbnN0IHR4ID0gVHJhbnNhY3Rpb24uZnJvbUNvbnRyYWN0V3JhcHBlcih7XG4gICAgICBjb250cmFjdFdyYXBwZXI6IHRoaXMuY29udHJhY3RXcmFwcGVyLFxuICAgICAgbWV0aG9kOiBcIm9mZmVyXCIsXG4gICAgICBhcmdzOiBbbGlzdGluZ0lkLCBsaXN0aW5nLnF1YW50aXR5LCBsaXN0aW5nLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzLCBub3JtYWxpemVkUHJpY2UsIGNvbnN0YW50cy5NYXhVaW50MjU2XSxcbiAgICAgIG92ZXJyaWRlc1xuICAgIH0pO1xuICAgIHR4LnNldEdhc0xpbWl0TXVsdGlwbGUoMS4yKTtcbiAgICByZXR1cm4gdHg7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBDYW5jZWwgQXVjdGlvbiBMaXN0aW5nXG4gICAqXG4gICAqIEByZW1hcmtzIENhbmNlbCBhbiBhdWN0aW9uIGxpc3Rpbmcgb24gdGhlIG1hcmtldHBsYWNlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGxpc3RpbmcgSUQgb2YgdGhlIGF1Y3Rpb24gbGlzdGluZyB5b3Ugd2FudCB0byBjYW5jZWxcbiAgICogY29uc3QgbGlzdGluZ0lkID0gXCIwXCI7XG4gICAqXG4gICAqIGF3YWl0IGNvbnRyYWN0LmF1Y3Rpb24uY2FuY2VsTGlzdGluZyhsaXN0aW5nSWQpO1xuICAgKiBgYGBcbiAgICovXG4gIGNhbmNlbExpc3RpbmcgPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgbGlzdGluZ0lkID0+IHtcbiAgICBjb25zdCBsaXN0aW5nID0gYXdhaXQgdGhpcy52YWxpZGF0ZUxpc3RpbmcoQmlnTnVtYmVyLmZyb20obGlzdGluZ0lkKSk7XG4gICAgY29uc3Qgbm93ID0gQmlnTnVtYmVyLmZyb20oTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkpO1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IEJpZ051bWJlci5mcm9tKGxpc3Rpbmcuc3RhcnRUaW1lSW5FcG9jaFNlY29uZHMpO1xuICAgIGNvbnN0IG9mZmVycyA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWQoXCJ3aW5uaW5nQmlkXCIsIFtsaXN0aW5nSWRdKTtcbiAgICBpZiAobm93Lmd0KHN0YXJ0VGltZSkgJiYgb2ZmZXJzLm9mZmVyb3IgIT09IGNvbnN0YW50cy5BZGRyZXNzWmVybykge1xuICAgICAgdGhyb3cgbmV3IEF1Y3Rpb25BbHJlYWR5U3RhcnRlZEVycm9yKGxpc3RpbmdJZC50b1N0cmluZygpKTtcbiAgICB9XG4gICAgY29uc3QgdHggPSBUcmFuc2FjdGlvbi5mcm9tQ29udHJhY3RXcmFwcGVyKHtcbiAgICAgIGNvbnRyYWN0V3JhcHBlcjogdGhpcy5jb250cmFjdFdyYXBwZXIsXG4gICAgICBtZXRob2Q6IFwiY2xvc2VBdWN0aW9uXCIsXG4gICAgICBhcmdzOiBbQmlnTnVtYmVyLmZyb20obGlzdGluZ0lkKSwgYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0U2lnbmVyQWRkcmVzcygpXVxuICAgIH0pO1xuICAgIHR4LnNldEdhc0xpbWl0TXVsdGlwbGUoMS4yKTtcbiAgICByZXR1cm4gdHg7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBDbG9zZSB0aGUgQXVjdGlvbiBmb3IgdGhlIGJ1eWVyIG9yIHRoZSBzZWxsZXJcbiAgICpcbiAgICogQHJlbWFya3MgQ2xvc2VzIHRoZSBBdWN0aW9uIGFuZCBleGVjdXRlcyB0aGUgc2FsZSBmb3IgdGhlIGJ1eWVyIG9yIHRoZSBzZWxsZXIuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGxpc3RpbmcgSUQgb2YgdGhlIGF1Y3Rpb24gbGlzdGluZyB5b3Ugd2FudCB0byBjbG9zZVxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSBcIjBcIjtcbiAgICogYXdhaXQgY29udHJhY3QuYXVjdGlvbi5jbG9zZUxpc3RpbmcobGlzdGluZ0lkKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSBsaXN0aW5nSWQgLSB0aGUgYXVjdGlvbiAgbGlzdGluZyB1ZCB0byBjbG9zZVxuICAgKiBAcGFyYW0gY2xvc2VGb3IgLSBvcHRpb25hbGx5IHBhc3MgdGhlIGF1Y3Rpb24gY3JlYXRvciBhZGRyZXNzIG9yIHdpbm5pbmcgYmlkIG9mZmVyb3IgYWRkcmVzcyB0byBjbG9zZSB0aGUgYXVjdGlvbiBvbiB0aGVpciBiZWhhbGZcbiAgICovXG4gIGNsb3NlTGlzdGluZyA9IC8qIEBfX1BVUkVfXyAqL2J1aWxkVHJhbnNhY3Rpb25GdW5jdGlvbihhc3luYyAobGlzdGluZ0lkLCBjbG9zZUZvcikgPT4ge1xuICAgIGlmICghY2xvc2VGb3IpIHtcbiAgICAgIGNsb3NlRm9yID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0U2lnbmVyQWRkcmVzcygpO1xuICAgIH1cbiAgICBjb25zdCBsaXN0aW5nID0gYXdhaXQgdGhpcy52YWxpZGF0ZUxpc3RpbmcoQmlnTnVtYmVyLmZyb20obGlzdGluZ0lkKSk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHR4ID0gVHJhbnNhY3Rpb24uZnJvbUNvbnRyYWN0V3JhcHBlcih7XG4gICAgICAgIGNvbnRyYWN0V3JhcHBlcjogdGhpcy5jb250cmFjdFdyYXBwZXIsXG4gICAgICAgIG1ldGhvZDogXCJjbG9zZUF1Y3Rpb25cIixcbiAgICAgICAgYXJnczogW0JpZ051bWJlci5mcm9tKGxpc3RpbmdJZCksIGNsb3NlRm9yXVxuICAgICAgfSk7XG4gICAgICB0eC5zZXRHYXNMaW1pdE11bHRpcGxlKDEuMik7XG4gICAgICByZXR1cm4gdHg7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoZXJyLm1lc3NhZ2UuaW5jbHVkZXMoXCJjYW5ub3QgY2xvc2UgYXVjdGlvbiBiZWZvcmUgaXQgaGFzIGVuZGVkXCIpKSB7XG4gICAgICAgIHRocm93IG5ldyBBdWN0aW9uSGFzTm90RW5kZWRFcnJvcihsaXN0aW5nSWQudG9TdHJpbmcoKSwgbGlzdGluZy5lbmRUaW1lSW5FcG9jaFNlY29uZHMudG9TdHJpbmcoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogRXhlY3V0ZSB0aGUgQXVjdGlvbiBTYWxlXG4gICAqXG4gICAqIEByZW1hcmtzIENsb3NlcyB0aGUgQXVjdGlvbiBhbmQgZXhlY3V0ZXMgdGhlIHNhbGUgZm9yIGJvdGggcGFydGllcy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBUaGUgbGlzdGluZyBJRCBvZiB0aGUgYXVjdGlvbiBsaXN0aW5nIHlvdSB3YW50IHRvIGNsb3NlXG4gICAqIGNvbnN0IGxpc3RpbmdJZCA9IFwiMFwiO1xuICAgKiBhd2FpdCBjb250cmFjdC5hdWN0aW9uLmV4ZWN1dGVTYWxlKGxpc3RpbmdJZCk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gdGhlIGF1Y3Rpb24gIGxpc3RpbmcgdWQgdG8gY2xvc2VcbiAgICovXG4gIGV4ZWN1dGVTYWxlID0gLyogQF9fUFVSRV9fICovYnVpbGRUcmFuc2FjdGlvbkZ1bmN0aW9uKGFzeW5jIGxpc3RpbmdJZCA9PiB7XG4gICAgY29uc3QgbGlzdGluZyA9IGF3YWl0IHRoaXMudmFsaWRhdGVMaXN0aW5nKEJpZ051bWJlci5mcm9tKGxpc3RpbmdJZCkpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB3aW5uaW5nQmlkID0gYXdhaXQgdGhpcy5nZXRXaW5uaW5nQmlkKGxpc3RpbmdJZCk7XG4gICAgICBpbnZhcmlhbnQod2lubmluZ0JpZCwgXCJObyB3aW5uaW5nIGJpZCBmb3VuZFwiKTtcbiAgICAgIGNvbnN0IGNsb3NlRm9yU2VsbGVyID0gdGhpcy5lbmNvZGVyLmVuY29kZShcImNsb3NlQXVjdGlvblwiLCBbbGlzdGluZ0lkLCBsaXN0aW5nLnNlbGxlckFkZHJlc3NdKTtcbiAgICAgIGNvbnN0IGNsb3NlRm9yQnV5ZXIgPSB0aGlzLmVuY29kZXIuZW5jb2RlKFwiY2xvc2VBdWN0aW9uXCIsIFtsaXN0aW5nSWQsIHdpbm5pbmdCaWQuYnV5ZXJBZGRyZXNzXSk7XG4gICAgICBjb25zdCB0eCA9IFRyYW5zYWN0aW9uLmZyb21Db250cmFjdFdyYXBwZXIoe1xuICAgICAgICBjb250cmFjdFdyYXBwZXI6IHRoaXMuY29udHJhY3RXcmFwcGVyLFxuICAgICAgICBtZXRob2Q6IFwibXVsdGljYWxsXCIsXG4gICAgICAgIGFyZ3M6IFtjbG9zZUZvclNlbGxlciwgY2xvc2VGb3JCdXllcl1cbiAgICAgIH0pO1xuICAgICAgdHguc2V0R2FzTGltaXRNdWx0aXBsZSgxLjIpO1xuICAgICAgcmV0dXJuIHR4O1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyci5tZXNzYWdlLmluY2x1ZGVzKFwiY2Fubm90IGNsb3NlIGF1Y3Rpb24gYmVmb3JlIGl0IGhhcyBlbmRlZFwiKSkge1xuICAgICAgICB0aHJvdyBuZXcgQXVjdGlvbkhhc05vdEVuZGVkRXJyb3IobGlzdGluZ0lkLnRvU3RyaW5nKCksIGxpc3RpbmcuZW5kVGltZUluRXBvY2hTZWNvbmRzLnRvU3RyaW5nKCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhbiBBdWN0aW9uIGxpc3Rpbmcgd2l0aCBuZXcgbWV0YWRhdGFcbiAgICogQHBhcmFtIGxpc3RpbmcgLSB0aGUgbGlzdGluZyBpZCB0byB1cGRhdGVcbiAgICovXG4gIHVwZGF0ZUxpc3RpbmcgPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgbGlzdGluZyA9PiB7XG4gICAgY29uc3QgdHggPSBUcmFuc2FjdGlvbi5mcm9tQ29udHJhY3RXcmFwcGVyKHtcbiAgICAgIGNvbnRyYWN0V3JhcHBlcjogdGhpcy5jb250cmFjdFdyYXBwZXIsXG4gICAgICBtZXRob2Q6IFwidXBkYXRlTGlzdGluZ1wiLFxuICAgICAgYXJnczogW2xpc3RpbmcuaWQsIGxpc3RpbmcucXVhbnRpdHksIGxpc3RpbmcucmVzZXJ2ZVByaWNlLCBsaXN0aW5nLmJ1eW91dFByaWNlLCBsaXN0aW5nLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzLCBsaXN0aW5nLnN0YXJ0VGltZUluRXBvY2hTZWNvbmRzLCBsaXN0aW5nLmVuZFRpbWVJbkVwb2NoU2Vjb25kc11cbiAgICB9KTtcbiAgICB0eC5zZXRHYXNMaW1pdE11bHRpcGxlKDEuMik7XG4gICAgcmV0dXJuIHR4O1xuICB9KTtcblxuICAvKipcbiAgICogR2V0IHRoZSBidWZmZXIgaW4gYmFzaXMgcG9pbnRzIGJldHdlZW4gb2ZmZXJzXG4gICAqL1xuICBhc3luYyBnZXRCaWRCdWZmZXJCcHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWQoXCJiaWRCdWZmZXJCcHNcIiwgW10pO1xuICB9XG5cbiAgLyoqXG4gICAqIHJldHVybnMgdGhlIG1pbmltdW0gYmlkIGEgdXNlciBjYW4gcGxhY2UgdG8gb3V0YmlkIHRoZSBwcmV2aW91cyBoaWdoZXN0IGJpZFxuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gdGhlIGxpc3RpbmcgaWQgb2YgdGhlIGF1Y3Rpb25cbiAgICovXG4gIGFzeW5jIGdldE1pbmltdW1OZXh0QmlkKGxpc3RpbmdJZCkge1xuICAgIC8vIHdlIGNhbiBmZXRjaCBhbGwgb2YgdGhlc2UgYXQgdGhlIHNhbWUgdGltZSB1c2luZyBwcm9taXNlLmFsbFxuICAgIGNvbnN0IFtjdXJyZW50QmlkQnVmZmVyQnBzLCB3aW5uaW5nQmlkLCBsaXN0aW5nXSA9IGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLmdldEJpZEJ1ZmZlckJwcygpLCB0aGlzLmdldFdpbm5pbmdCaWQobGlzdGluZ0lkKSwgdGhpcy52YWxpZGF0ZUxpc3RpbmcoQmlnTnVtYmVyLmZyb20obGlzdGluZ0lkKSldKTtcbiAgICBjb25zdCBjdXJyZW50QmlkT3JSZXNlcnZlUHJpY2UgPSB3aW5uaW5nQmlkID9cbiAgICAvLyBpZiB0aGVyZSBpcyBhIHdpbm5pbmcgYmlkIHVzZSB0aGUgdmFsdWUgb2YgaXRcbiAgICB3aW5uaW5nQmlkLmN1cnJlbmN5VmFsdWUudmFsdWUgOlxuICAgIC8vIGlmIHRoZXJlIGlzIG5vIHdpbm5pbmcgYmlkIHVzZSB0aGUgcmVzZXJ2ZSBwcmljZVxuICAgIGxpc3RpbmcucmVzZXJ2ZVByaWNlO1xuICAgIGNvbnN0IG1pbmltdW1OZXh0QmlkID0gY3VycmVudEJpZE9yUmVzZXJ2ZVByaWNlLmFkZChcbiAgICAvLyB0aGUgYWRkaXRpb24gb2YgdGhlIGN1cnJlbnQgYmlkIGFuZCB0aGUgYnVmZmVyXG4gICAgLy8gKGhhdmUgdG8gZGl2aWRlIGJ5IDEwMDAwIHRvIGdldCB0aGUgZnJhY3Rpb24gb2YgdGhlIGJ1ZmZlciAoc2luY2UgaXQncyBpbiBiYXNpcyBwb2ludHMpKVxuICAgIGN1cnJlbnRCaWRPclJlc2VydmVQcmljZS5tdWwoY3VycmVudEJpZEJ1ZmZlckJwcykuZGl2KDEwMDAwKSk7XG5cbiAgICAvLyBpdCdzIG1vcmUgdXNlZnVsIHRvIHJldHVybiBhIGN1cnJlbmN5IHZhbHVlIGhlcmVcbiAgICByZXR1cm4gZmV0Y2hDdXJyZW5jeVZhbHVlKHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCksIGxpc3RpbmcuY3VycmVuY3lDb250cmFjdEFkZHJlc3MsIG1pbmltdW1OZXh0QmlkKTtcbiAgfVxuXG4gIC8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICogUFJJVkFURSBGVU5DVElPTlNcbiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbiAgLyoqXG4gICAqIFRocm93cyBlcnJvciBpZiBsaXN0aW5nIGNvdWxkIG5vdCBiZSBmb3VuZFxuICAgKlxuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gTGlzdGluZyB0byBjaGVjayBmb3JcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlTGlzdGluZyhsaXN0aW5nSWQpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0TGlzdGluZyhsaXN0aW5nSWQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZ2V0dGluZyB0aGUgbGlzdGluZyB3aXRoIGlkICR7bGlzdGluZ0lkfWApO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgbWV0aG9kIG1hcHMgdGhlIGF1Y3Rpb24gbGlzdGluZyB0byB0aGUgYXVjdGlvbiBsaXN0aW5nIGludGVyZmFjZS5cbiAgICpcbiAgICogQGludGVybmFsXG4gICAqIEBwYXJhbSBsaXN0aW5nIC0gVGhlIGxpc3RpbmcgdG8gbWFwLCBhcyByZXR1cm5lZCBmcm9tIHRoZSBjb250cmFjdC5cbiAgICogQHJldHVybnMgIFRoZSBtYXBwZWQgaW50ZXJmYWNlLlxuICAgKi9cbiAgYXN5bmMgbWFwTGlzdGluZyhsaXN0aW5nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGFzc2V0Q29udHJhY3RBZGRyZXNzOiBsaXN0aW5nLmFzc2V0Q29udHJhY3QsXG4gICAgICBidXlvdXRQcmljZTogQmlnTnVtYmVyLmZyb20obGlzdGluZy5idXlvdXRQcmljZVBlclRva2VuKSxcbiAgICAgIGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzOiBsaXN0aW5nLmN1cnJlbmN5LFxuICAgICAgYnV5b3V0Q3VycmVuY3lWYWx1ZVBlclRva2VuOiBhd2FpdCBmZXRjaEN1cnJlbmN5VmFsdWUodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgbGlzdGluZy5jdXJyZW5jeSwgbGlzdGluZy5idXlvdXRQcmljZVBlclRva2VuKSxcbiAgICAgIGlkOiBsaXN0aW5nLmxpc3RpbmdJZC50b1N0cmluZygpLFxuICAgICAgdG9rZW5JZDogbGlzdGluZy50b2tlbklkLFxuICAgICAgcXVhbnRpdHk6IGxpc3RpbmcucXVhbnRpdHksXG4gICAgICBzdGFydFRpbWVJbkVwb2NoU2Vjb25kczogbGlzdGluZy5zdGFydFRpbWUsXG4gICAgICBhc3NldDogYXdhaXQgZmV0Y2hUb2tlbk1ldGFkYXRhRm9yQ29udHJhY3QobGlzdGluZy5hc3NldENvbnRyYWN0LCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBsaXN0aW5nLnRva2VuSWQsIHRoaXMuc3RvcmFnZSksXG4gICAgICByZXNlcnZlUHJpY2VDdXJyZW5jeVZhbHVlUGVyVG9rZW46IGF3YWl0IGZldGNoQ3VycmVuY3lWYWx1ZSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBsaXN0aW5nLmN1cnJlbmN5LCBsaXN0aW5nLnJlc2VydmVQcmljZVBlclRva2VuKSxcbiAgICAgIHJlc2VydmVQcmljZTogQmlnTnVtYmVyLmZyb20obGlzdGluZy5yZXNlcnZlUHJpY2VQZXJUb2tlbiksXG4gICAgICBlbmRUaW1lSW5FcG9jaFNlY29uZHM6IGxpc3RpbmcuZW5kVGltZSxcbiAgICAgIHNlbGxlckFkZHJlc3M6IGxpc3RpbmcudG9rZW5Pd25lcixcbiAgICAgIHR5cGU6IExpc3RpbmdUeXBlLkF1Y3Rpb25cbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogSGFuZGxlcyBkaXJlY3QgbGlzdGluZ3NcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgTWFya2V0cGxhY2VEaXJlY3Qge1xuICBjb25zdHJ1Y3Rvcihjb250cmFjdFdyYXBwZXIsIHN0b3JhZ2UpIHtcbiAgICB0aGlzLmNvbnRyYWN0V3JhcHBlciA9IGNvbnRyYWN0V3JhcHBlcjtcbiAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlO1xuICB9XG4gIGdldEFkZHJlc3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29udHJhY3RXcmFwcGVyLmFkZHJlc3M7XG4gIH1cblxuICAvKiogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIFJFQUQgRlVOQ1RJT05TXG4gICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBHZXQgYSBkaXJlY3QgbGlzdGluZyBieSBpZFxuICAgKlxuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gdGhlIGxpc3RpbmcgaWRcbiAgICogQHJldHVybnMgVGhlIERpcmVjdCBsaXN0aW5nIG9iamVjdFxuICAgKi9cbiAgYXN5bmMgZ2V0TGlzdGluZyhsaXN0aW5nSWQpIHtcbiAgICBjb25zdCBsaXN0aW5nID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZChcImxpc3RpbmdzXCIsIFtsaXN0aW5nSWRdKTtcbiAgICBpZiAobGlzdGluZy5hc3NldENvbnRyYWN0ID09PSBjb25zdGFudHMuQWRkcmVzc1plcm8pIHtcbiAgICAgIHRocm93IG5ldyBMaXN0aW5nTm90Rm91bmRFcnJvcih0aGlzLmdldEFkZHJlc3MoKSwgbGlzdGluZ0lkLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBpZiAobGlzdGluZy5saXN0aW5nVHlwZSAhPT0gTGlzdGluZ1R5cGUuRGlyZWN0KSB7XG4gICAgICB0aHJvdyBuZXcgV3JvbmdMaXN0aW5nVHlwZUVycm9yKHRoaXMuZ2V0QWRkcmVzcygpLCBsaXN0aW5nSWQudG9TdHJpbmcoKSwgXCJBdWN0aW9uXCIsIFwiRGlyZWN0XCIpO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5tYXBMaXN0aW5nKGxpc3RpbmcpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgYWN0aXZlIG9mZmVyIG9uIGEgbGlzdGluZ1xuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gdGhlIGxpc3RpbmcgaWRcbiAgICogQHBhcmFtIGFkZHJlc3MgLSB0aGUgYWRkcmVzcyB0aGF0IG1hZGUgdGhlIG9mZmVyXG4gICAqL1xuICBhc3luYyBnZXRBY3RpdmVPZmZlcihsaXN0aW5nSWQsIGFkZHJlc3MpIHtcbiAgICBhd2FpdCB0aGlzLnZhbGlkYXRlTGlzdGluZyhCaWdOdW1iZXIuZnJvbShsaXN0aW5nSWQpKTtcbiAgICBpbnZhcmlhbnQodXRpbHMuaXNBZGRyZXNzKGFkZHJlc3MpLCBcIkFkZHJlc3MgbXVzdCBiZSBhIHZhbGlkIGFkZHJlc3NcIik7XG4gICAgY29uc3Qgb2ZmZXJzID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZChcIm9mZmVyc1wiLCBbbGlzdGluZ0lkLCBhd2FpdCByZXNvbHZlQWRkcmVzcyhhZGRyZXNzKV0pO1xuICAgIGlmIChvZmZlcnMub2ZmZXJvciA9PT0gY29uc3RhbnRzLkFkZHJlc3NaZXJvKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgbWFwT2ZmZXIodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgQmlnTnVtYmVyLmZyb20obGlzdGluZ0lkKSwgb2ZmZXJzKTtcbiAgfVxuXG4gIC8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICogV1JJVEUgRlVOQ1RJT05TXG4gICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgRGlyZWN0IExpc3RpbmdcbiAgICpcbiAgICogQHJlbWFya3MgQ3JlYXRlIGEgbmV3IGxpc3Rpbmcgb24gdGhlIG1hcmtldHBsYWNlIHdoZXJlIHBlb3BsZSBjYW4gYnV5IGFuIGFzc2V0IGRpcmVjdGx5LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIERhdGEgb2YgdGhlIGxpc3RpbmcgeW91IHdhbnQgdG8gY3JlYXRlXG4gICAqIGNvbnN0IGxpc3RpbmcgPSB7XG4gICAqICAgLy8gYWRkcmVzcyBvZiB0aGUgY29udHJhY3QgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGxpc3QgaXMgb25cbiAgICogICBhc3NldENvbnRyYWN0QWRkcmVzczogXCIweC4uLlwiLFxuICAgKiAgIC8vIHRva2VuIElEIG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBsaXN0XG4gICAqICAgdG9rZW5JZDogXCIwXCIsXG4gICAqICAgLy8gd2hlbiBzaG91bGQgdGhlIGxpc3Rpbmcgb3BlbiB1cCBmb3Igb2ZmZXJzXG4gICAqICAgc3RhcnRUaW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAqICAgLy8gaG93IGxvbmcgdGhlIGxpc3Rpbmcgd2lsbCBiZSBvcGVuIGZvclxuICAgKiAgIGxpc3RpbmdEdXJhdGlvbkluU2Vjb25kczogODY0MDAsXG4gICAqICAgLy8gaG93IG1hbnkgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGxpc3RcbiAgICogICBxdWFudGl0eTogMSxcbiAgICogICAvLyBhZGRyZXNzIG9mIHRoZSBjdXJyZW5jeSBjb250cmFjdCB0aGF0IHdpbGwgYmUgdXNlZCB0byBwYXkgZm9yIHRoZSBsaXN0aW5nXG4gICAqICAgY3VycmVuY3lDb250cmFjdEFkZHJlc3M6IE5BVElWRV9UT0tFTl9BRERSRVNTLFxuICAgKiAgIC8vIGhvdyBtdWNoIHRoZSBhc3NldCB3aWxsIGJlIHNvbGQgZm9yXG4gICAqICAgYnV5b3V0UHJpY2VQZXJUb2tlbjogXCIxLjVcIixcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0LmRpcmVjdC5jcmVhdGVMaXN0aW5nKGxpc3RpbmcpO1xuICAgKiBjb25zdCByZWNlaXB0ID0gdHgucmVjZWlwdDsgLy8gdGhlIHRyYW5zYWN0aW9uIHJlY2VpcHRcbiAgICogY29uc3QgaWQgPSB0eC5pZDsgLy8gdGhlIGlkIG9mIHRoZSBuZXdseSBjcmVhdGVkIGxpc3RpbmdcbiAgICogYGBgXG4gICAqL1xuICBjcmVhdGVMaXN0aW5nID0gLyogQF9fUFVSRV9fICovYnVpbGRUcmFuc2FjdGlvbkZ1bmN0aW9uKGFzeW5jIGxpc3RpbmcgPT4ge1xuICAgIHZhbGlkYXRlTmV3TGlzdGluZ1BhcmFtKGxpc3RpbmcpO1xuICAgIGNvbnN0IHJlc29sdmVkQXNzZXRBZGRyZXNzID0gYXdhaXQgcmVzb2x2ZUFkZHJlc3MobGlzdGluZy5hc3NldENvbnRyYWN0QWRkcmVzcyk7XG4gICAgY29uc3QgcmVzb2x2ZWRDdXJyZW5jeUFkZHJlc3MgPSBhd2FpdCByZXNvbHZlQWRkcmVzcyhsaXN0aW5nLmN1cnJlbmN5Q29udHJhY3RBZGRyZXNzKTtcbiAgICBhd2FpdCBoYW5kbGVUb2tlbkFwcHJvdmFsKHRoaXMuY29udHJhY3RXcmFwcGVyLCB0aGlzLmdldEFkZHJlc3MoKSwgcmVzb2x2ZWRBc3NldEFkZHJlc3MsIGxpc3RpbmcudG9rZW5JZCwgYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0U2lnbmVyQWRkcmVzcygpKTtcbiAgICBjb25zdCBub3JtYWxpemVkUHJpY2VQZXJUb2tlbiA9IGF3YWl0IG5vcm1hbGl6ZVByaWNlVmFsdWUodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgbGlzdGluZy5idXlvdXRQcmljZVBlclRva2VuLCByZXNvbHZlZEN1cnJlbmN5QWRkcmVzcyk7XG4gICAgbGV0IGxpc3RpbmdTdGFydFRpbWUgPSBNYXRoLmZsb29yKGxpc3Rpbmcuc3RhcnRUaW1lc3RhbXAuZ2V0VGltZSgpIC8gMTAwMCk7XG4gICAgY29uc3QgYmxvY2sgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLmdldEJsb2NrKFwibGF0ZXN0XCIpO1xuICAgIGNvbnN0IGJsb2NrVGltZSA9IGJsb2NrLnRpbWVzdGFtcDtcbiAgICBpZiAobGlzdGluZ1N0YXJ0VGltZSA8IGJsb2NrVGltZSkge1xuICAgICAgbGlzdGluZ1N0YXJ0VGltZSA9IGJsb2NrVGltZTtcbiAgICB9XG4gICAgY29uc3QgdHggPSBUcmFuc2FjdGlvbi5mcm9tQ29udHJhY3RXcmFwcGVyKHtcbiAgICAgIGNvbnRyYWN0V3JhcHBlcjogdGhpcy5jb250cmFjdFdyYXBwZXIsXG4gICAgICBtZXRob2Q6IFwiY3JlYXRlTGlzdGluZ1wiLFxuICAgICAgYXJnczogW3tcbiAgICAgICAgYXNzZXRDb250cmFjdDogcmVzb2x2ZWRBc3NldEFkZHJlc3MsXG4gICAgICAgIHRva2VuSWQ6IGxpc3RpbmcudG9rZW5JZCxcbiAgICAgICAgYnV5b3V0UHJpY2VQZXJUb2tlbjogbm9ybWFsaXplZFByaWNlUGVyVG9rZW4sXG4gICAgICAgIGN1cnJlbmN5VG9BY2NlcHQ6IGNsZWFuQ3VycmVuY3lBZGRyZXNzKHJlc29sdmVkQ3VycmVuY3lBZGRyZXNzKSxcbiAgICAgICAgbGlzdGluZ1R5cGU6IExpc3RpbmdUeXBlLkRpcmVjdCxcbiAgICAgICAgcXVhbnRpdHlUb0xpc3Q6IGxpc3RpbmcucXVhbnRpdHksXG4gICAgICAgIHJlc2VydmVQcmljZVBlclRva2VuOiBub3JtYWxpemVkUHJpY2VQZXJUb2tlbixcbiAgICAgICAgc2Vjb25kc1VudGlsRW5kVGltZTogbGlzdGluZy5saXN0aW5nRHVyYXRpb25JblNlY29uZHMsXG4gICAgICAgIHN0YXJ0VGltZTogQmlnTnVtYmVyLmZyb20obGlzdGluZ1N0YXJ0VGltZSlcbiAgICAgIH1dLFxuICAgICAgcGFyc2U6IHJlY2VpcHQgPT4ge1xuICAgICAgICBjb25zdCBldmVudCA9IHRoaXMuY29udHJhY3RXcmFwcGVyLnBhcnNlTG9ncyhcIkxpc3RpbmdBZGRlZFwiLCByZWNlaXB0Py5sb2dzKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpZDogZXZlbnRbMF0uYXJncy5saXN0aW5nSWQsXG4gICAgICAgICAgcmVjZWlwdFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHR4LnNldEdhc0xpbWl0TXVsdGlwbGUoMS4yKTtcbiAgICByZXR1cm4gdHg7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBiYXRjaCBvZiBuZXcgbGlzdGluZ3NcbiAgICpcbiAgICogQHJlbWFya3MgQ3JlYXRlIGEgYmF0Y2ggb2YgbmV3IGxpc3RpbmdzIG9uIHRoZSBtYXJrZXRwbGFjZVxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IGxpc3RpbmdzID0gWy4uLl07XG4gICAqIGNvbnN0IHR4ID0gYXdhaXQgY29udHJhY3QuZGlyZWN0LmNyZWF0ZUxpc3RpbmdzQmF0Y2gobGlzdGluZ3MpO1xuICAgKiBgYGBcbiAgICovXG4gIGNyZWF0ZUxpc3RpbmdzQmF0Y2ggPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgbGlzdGluZ3MgPT4ge1xuICAgIGNvbnN0IGRhdGEgPSAoYXdhaXQgUHJvbWlzZS5hbGwobGlzdGluZ3MubWFwKGxpc3RpbmcgPT4gdGhpcy5jcmVhdGVMaXN0aW5nLnByZXBhcmUobGlzdGluZykpKSkubWFwKHR4ID0+IHR4LmVuY29kZSgpKTtcbiAgICBjb25zdCB0eCA9IFRyYW5zYWN0aW9uLmZyb21Db250cmFjdFdyYXBwZXIoe1xuICAgICAgY29udHJhY3RXcmFwcGVyOiB0aGlzLmNvbnRyYWN0V3JhcHBlcixcbiAgICAgIG1ldGhvZDogXCJtdWx0aWNhbGxcIixcbiAgICAgIGFyZ3M6IFtkYXRhXSxcbiAgICAgIHBhcnNlOiByZWNlaXB0ID0+IHtcbiAgICAgICAgY29uc3QgZXZlbnRzID0gdGhpcy5jb250cmFjdFdyYXBwZXIucGFyc2VMb2dzKFwiTGlzdGluZ0FkZGVkXCIsIHJlY2VpcHQ/LmxvZ3MpO1xuICAgICAgICByZXR1cm4gZXZlbnRzLm1hcChldmVudCA9PiB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkOiBldmVudC5hcmdzLmxpc3RpbmdJZCxcbiAgICAgICAgICAgIHJlY2VpcHRcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0eC5zZXRHYXNMaW1pdE11bHRpcGxlKDEuMik7XG4gICAgcmV0dXJuIHR4O1xuICB9KTtcblxuICAvKipcbiAgICogTWFrZSBhbiBvZmZlciBmb3IgYSBEaXJlY3QgTGlzdGluZ1xuICAgKlxuICAgKiBAcmVtYXJrcyBNYWtlIGFuIG9mZmVyIG9uIGEgZGlyZWN0IGxpc3RpbmdcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiBpbXBvcnQgeyBDaGFpbklkLCBOQVRJVkVfVE9LRU5TIH0gZnJvbSBcIkB0aGlyZHdlYi1kZXYvc2RrXCI7XG4gICAqXG4gICAqIC8vIFRoZSBsaXN0aW5nIElEIG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBvZmZlciBvblxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSAwO1xuICAgKiAvLyBUaGUgcHJpY2UgeW91IGFyZSB3aWxsaW5nIHRvIG9mZmVyIHBlciB0b2tlblxuICAgKiBjb25zdCBwcmljZVBlclRva2VuID0gMTtcbiAgICogLy8gVGhlIHF1YW50aXR5IG9mIHRva2VucyB5b3Ugd2FudCB0byByZWNlaXZlIGZvciB0aGlzIG9mZmVyXG4gICAqIGNvbnN0IHF1YW50aXR5ID0gMTtcbiAgICogLy8gVGhlIGFkZHJlc3Mgb2YgdGhlIGN1cnJlbmN5IHlvdSBhcmUgbWFraW5nIHRoZSBvZmZlciBpbiAobXVzdCBiZSBFUkMtMjApXG4gICAqIGNvbnN0IGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzID0gTkFUSVZFX1RPS0VOU1tDaGFpbklkLlJpbmtlYnldLndyYXBwZWQuYWRkcmVzc1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5kaXJlY3QubWFrZU9mZmVyKFxuICAgKiAgIGxpc3RpbmdJZCxcbiAgICogICBxdWFudGl0eSxcbiAgICogICBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyxcbiAgICogICBwcmljZVBlclRva2VuXG4gICAqICk7XG4gICAqIGBgYFxuICAgKi9cbiAgbWFrZU9mZmVyID0gLyogQF9fUFVSRV9fICovYnVpbGRUcmFuc2FjdGlvbkZ1bmN0aW9uKGFzeW5jIChsaXN0aW5nSWQsIHF1YW50aXR5RGVzaXJlZCwgY3VycmVuY3lDb250cmFjdEFkZHJlc3MsIHByaWNlUGVyVG9rZW4sIGV4cGlyYXRpb25EYXRlKSA9PiB7XG4gICAgaWYgKGlzTmF0aXZlVG9rZW4oY3VycmVuY3lDb250cmFjdEFkZHJlc3MpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3UgbXVzdCB1c2UgdGhlIHdyYXBwZWQgbmF0aXZlIHRva2VuIGFkZHJlc3Mgd2hlbiBtYWtpbmcgYW4gb2ZmZXIgd2l0aCBhIG5hdGl2ZSB0b2tlblwiKTtcbiAgICB9XG4gICAgY29uc3Qgbm9ybWFsaXplZFByaWNlID0gYXdhaXQgbm9ybWFsaXplUHJpY2VWYWx1ZSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBwcmljZVBlclRva2VuLCBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcyk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuZ2V0TGlzdGluZyhsaXN0aW5nSWQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgbGlzdGluZywgZXJyID1cIiwgZXJyKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXJyb3IgZ2V0dGluZyB0aGUgbGlzdGluZyB3aXRoIGlkICR7bGlzdGluZ0lkfWApO1xuICAgIH1cbiAgICBjb25zdCBxdWFudGl0eSA9IEJpZ051bWJlci5mcm9tKHF1YW50aXR5RGVzaXJlZCk7XG4gICAgY29uc3QgdmFsdWUgPSBCaWdOdW1iZXIuZnJvbShub3JtYWxpemVkUHJpY2UpLm11bChxdWFudGl0eSk7XG4gICAgY29uc3Qgb3ZlcnJpZGVzID0gKGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldENhbGxPdmVycmlkZXMoKSkgfHwge307XG4gICAgYXdhaXQgc2V0RXJjMjBBbGxvd2FuY2UodGhpcy5jb250cmFjdFdyYXBwZXIsIHZhbHVlLCBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcywgb3ZlcnJpZGVzKTtcbiAgICBsZXQgZXhwaXJhdGlvblRpbWVzdGFtcCA9IGNvbnN0YW50cy5NYXhVaW50MjU2O1xuICAgIGlmIChleHBpcmF0aW9uRGF0ZSkge1xuICAgICAgZXhwaXJhdGlvblRpbWVzdGFtcCA9IEJpZ051bWJlci5mcm9tKE1hdGguZmxvb3IoZXhwaXJhdGlvbkRhdGUuZ2V0VGltZSgpIC8gMTAwMCkpO1xuICAgIH1cbiAgICBjb25zdCB0eCA9IFRyYW5zYWN0aW9uLmZyb21Db250cmFjdFdyYXBwZXIoe1xuICAgICAgY29udHJhY3RXcmFwcGVyOiB0aGlzLmNvbnRyYWN0V3JhcHBlcixcbiAgICAgIG1ldGhvZDogXCJvZmZlclwiLFxuICAgICAgYXJnczogW2xpc3RpbmdJZCwgcXVhbnRpdHlEZXNpcmVkLCBjdXJyZW5jeUNvbnRyYWN0QWRkcmVzcywgbm9ybWFsaXplZFByaWNlLCBleHBpcmF0aW9uVGltZXN0YW1wXSxcbiAgICAgIG92ZXJyaWRlc1xuICAgIH0pO1xuICAgIHR4LnNldEdhc0xpbWl0TXVsdGlwbGUoMS4yKTtcbiAgICByZXR1cm4gdHg7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBBY2NlcHQgYW4gb2ZmZXIgb24gYSBkaXJlY3QgbGlzdGluZ1xuICAgKlxuICAgKiBAcmVtYXJrcyBBY2NlcHQgYW4gb2ZmZXIgb24gYSBkaXJlY3QgbGlzdGluZ1xuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIFRoZSBsaXN0aW5nIElEIG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBiaWQgb25cbiAgICogY29uc3QgbGlzdGluZ0lkID0gMDtcbiAgICogLy8gVGhlIHByaWNlIHlvdSBhcmUgd2lsbGluZyB0byBiaWQgZm9yIGEgc2luZ2xlIHRva2VuIG9mIHRoZSBsaXN0aW5nXG4gICAqIGNvbnN0IG9mZmVyb3IgPSBcIjB4Li4uXCI7XG4gICAqXG4gICAqIGF3YWl0IGNvbnRyYWN0LmRpcmVjdC5hY2NlcHRPZmZlcihsaXN0aW5nSWQsIG9mZmVyb3IpO1xuICAgKiBgYGBcbiAgICovXG4gIGFjY2VwdE9mZmVyID0gLyogQF9fUFVSRV9fICovYnVpbGRUcmFuc2FjdGlvbkZ1bmN0aW9uKGFzeW5jIChsaXN0aW5nSWQsIGFkZHJlc3NPZk9mZmVyb3IpID0+IHtcbiAgICAvKipcbiAgICAgKiBUT0RPOlxuICAgICAqIC0gUHJvdmlkZSBiZXR0ZXIgZXJyb3IgaGFuZGxpbmcgaWYgb2ZmZXIgaXMgdG9vIGxvdy5cbiAgICAgKi9cbiAgICBhd2FpdCB0aGlzLnZhbGlkYXRlTGlzdGluZyhCaWdOdW1iZXIuZnJvbShsaXN0aW5nSWQpKTtcbiAgICBjb25zdCByZXNvbHZlZEFkZHJlc3MgPSBhd2FpdCByZXNvbHZlQWRkcmVzcyhhZGRyZXNzT2ZPZmZlcm9yKTtcbiAgICBjb25zdCBvZmZlciA9IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLnJlYWQoXCJvZmZlcnNcIiwgW2xpc3RpbmdJZCwgcmVzb2x2ZWRBZGRyZXNzXSk7XG4gICAgY29uc3QgdHggPSBUcmFuc2FjdGlvbi5mcm9tQ29udHJhY3RXcmFwcGVyKHtcbiAgICAgIGNvbnRyYWN0V3JhcHBlcjogdGhpcy5jb250cmFjdFdyYXBwZXIsXG4gICAgICBtZXRob2Q6IFwiYWNjZXB0T2ZmZXJcIixcbiAgICAgIGFyZ3M6IFtsaXN0aW5nSWQsIHJlc29sdmVkQWRkcmVzcywgb2ZmZXIuY3VycmVuY3ksIG9mZmVyLnByaWNlUGVyVG9rZW5dXG4gICAgfSk7XG4gICAgdHguc2V0R2FzTGltaXRNdWx0aXBsZSgxLjIpO1xuICAgIHJldHVybiB0eDtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIEJ1eSBhIExpc3RpbmdcbiAgICpcbiAgICogQHJlbWFya3MgQnV5IGEgc3BlY2lmaWMgZGlyZWN0IGxpc3RpbmcgZnJvbSB0aGUgbWFya2V0cGxhY2UuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGxpc3RpbmcgSUQgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGJ1eVxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSAwO1xuICAgKiAvLyBRdWFudGl0eSBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gYnV5XG4gICAqIGNvbnN0IHF1YW50aXR5RGVzaXJlZCA9IDE7XG4gICAqXG4gICAqIGF3YWl0IGNvbnRyYWN0LmRpcmVjdC5idXlvdXRMaXN0aW5nKGxpc3RpbmdJZCwgcXVhbnRpdHlEZXNpcmVkKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSBsaXN0aW5nSWQgLSBUaGUgbGlzdGluZyBpZCB0byBidXlcbiAgICogQHBhcmFtIHF1YW50aXR5RGVzaXJlZCAtIHRoZSBxdWFudGl0eSB0byBidXlcbiAgICogQHBhcmFtIHJlY2VpdmVyIC0gb3B0aW9uYWwgcmVjZWl2ZXIgb2YgdGhlIGJvdWdodCBsaXN0aW5nIGlmIGRpZmZlcmVudCBmcm9tIHRoZSBjb25uZWN0ZWQgd2FsbGV0XG4gICAqL1xuICBidXlvdXRMaXN0aW5nID0gLyogQF9fUFVSRV9fICovYnVpbGRUcmFuc2FjdGlvbkZ1bmN0aW9uKGFzeW5jIChsaXN0aW5nSWQsIHF1YW50aXR5RGVzaXJlZCwgcmVjZWl2ZXIpID0+IHtcbiAgICBjb25zdCBsaXN0aW5nID0gYXdhaXQgdGhpcy52YWxpZGF0ZUxpc3RpbmcoQmlnTnVtYmVyLmZyb20obGlzdGluZ0lkKSk7XG4gICAgY29uc3Qge1xuICAgICAgdmFsaWQsXG4gICAgICBlcnJvclxuICAgIH0gPSBhd2FpdCB0aGlzLmlzU3RpbGxWYWxpZExpc3RpbmcobGlzdGluZywgcXVhbnRpdHlEZXNpcmVkKTtcbiAgICBpZiAoIXZhbGlkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYExpc3RpbmcgJHtsaXN0aW5nSWR9IGlzIG5vIGxvbmdlciB2YWxpZC4gJHtlcnJvcn1gKTtcbiAgICB9XG4gICAgY29uc3QgYnV5Rm9yID0gcmVjZWl2ZXIgPyByZWNlaXZlciA6IGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFNpZ25lckFkZHJlc3MoKTtcbiAgICBjb25zdCBxdWFudGl0eSA9IEJpZ051bWJlci5mcm9tKHF1YW50aXR5RGVzaXJlZCk7XG4gICAgY29uc3QgdmFsdWUgPSBCaWdOdW1iZXIuZnJvbShsaXN0aW5nLmJ1eW91dFByaWNlKS5tdWwocXVhbnRpdHkpO1xuICAgIGNvbnN0IG92ZXJyaWRlcyA9IChhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRDYWxsT3ZlcnJpZGVzKCkpIHx8IHt9O1xuICAgIGF3YWl0IHNldEVyYzIwQWxsb3dhbmNlKHRoaXMuY29udHJhY3RXcmFwcGVyLCB2YWx1ZSwgbGlzdGluZy5jdXJyZW5jeUNvbnRyYWN0QWRkcmVzcywgb3ZlcnJpZGVzKTtcbiAgICBjb25zdCB0eCA9IFRyYW5zYWN0aW9uLmZyb21Db250cmFjdFdyYXBwZXIoe1xuICAgICAgY29udHJhY3RXcmFwcGVyOiB0aGlzLmNvbnRyYWN0V3JhcHBlcixcbiAgICAgIG1ldGhvZDogXCJidXlcIixcbiAgICAgIGFyZ3M6IFtsaXN0aW5nSWQsIGJ1eUZvciwgcXVhbnRpdHksIGxpc3RpbmcuY3VycmVuY3lDb250cmFjdEFkZHJlc3MsIHZhbHVlXSxcbiAgICAgIG92ZXJyaWRlc1xuICAgIH0pO1xuICAgIHR4LnNldEdhc0xpbWl0TXVsdGlwbGUoMS4yKTtcbiAgICByZXR1cm4gdHg7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgYSBEaXJlY3QgbGlzdGluZyB3aXRoIG5ldyBtZXRhZGF0YS5cbiAgICpcbiAgICogTm90ZTogY2Fubm90IHVwZGF0ZSBhIGxpc3Rpbmcgd2l0aCBhIG5ldyBxdWFudGl0eSBvZiAwLiBVc2UgYGNhbmNlbERpcmVjdExpc3RpbmdgIHRvIHJlbW92ZSBhIGxpc3RpbmcgaW5zdGVhZC5cbiAgICpcbiAgICogQHBhcmFtIGxpc3RpbmcgLSB0aGUgbmV3IGxpc3RpbmcgaW5mb3JtYXRpb25cbiAgICovXG4gIHVwZGF0ZUxpc3RpbmcgPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgbGlzdGluZyA9PiB7XG4gICAgY29uc3QgdHggPSBUcmFuc2FjdGlvbi5mcm9tQ29udHJhY3RXcmFwcGVyKHtcbiAgICAgIGNvbnRyYWN0V3JhcHBlcjogdGhpcy5jb250cmFjdFdyYXBwZXIsXG4gICAgICBtZXRob2Q6IFwidXBkYXRlTGlzdGluZ1wiLFxuICAgICAgYXJnczogW2xpc3RpbmcuaWQsIGxpc3RpbmcucXVhbnRpdHksIGxpc3RpbmcuYnV5b3V0UHJpY2UsXG4gICAgICAvLyByZXNlcnZlIHByaWNlLCBkb2Vzbid0IG1hdHRlciBmb3IgZGlyZWN0IGxpc3RpbmdcbiAgICAgIGxpc3RpbmcuYnV5b3V0UHJpY2UsIGF3YWl0IHJlc29sdmVBZGRyZXNzKGxpc3RpbmcuY3VycmVuY3lDb250cmFjdEFkZHJlc3MpLCBsaXN0aW5nLnN0YXJ0VGltZUluU2Vjb25kcywgbGlzdGluZy5zZWNvbmRzVW50aWxFbmRdXG4gICAgfSk7XG4gICAgdHguc2V0R2FzTGltaXRNdWx0aXBsZSgxLjIpO1xuICAgIHJldHVybiB0eDtcbiAgfSk7XG5cbiAgLyoqXG4gICAqIENhbmNlbCBEaXJlY3QgTGlzdGluZ1xuICAgKlxuICAgKiBAcmVtYXJrcyBDYW5jZWwgYSBkaXJlY3QgbGlzdGluZyBvbiB0aGUgbWFya2V0cGxhY2VcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyBUaGUgbGlzdGluZyBJRCBvZiB0aGUgZGlyZWN0IGxpc3RpbmcgeW91IHdhbnQgdG8gY2FuY2VsXG4gICAqIGNvbnN0IGxpc3RpbmdJZCA9IFwiMFwiO1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5kaXJlY3QuY2FuY2VsTGlzdGluZyhsaXN0aW5nSWQpO1xuICAgKiBgYGBcbiAgICovXG4gIGNhbmNlbExpc3RpbmcgPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgbGlzdGluZ0lkID0+IHtcbiAgICBjb25zdCB0eCA9IFRyYW5zYWN0aW9uLmZyb21Db250cmFjdFdyYXBwZXIoe1xuICAgICAgY29udHJhY3RXcmFwcGVyOiB0aGlzLmNvbnRyYWN0V3JhcHBlcixcbiAgICAgIG1ldGhvZDogXCJjYW5jZWxEaXJlY3RMaXN0aW5nXCIsXG4gICAgICBhcmdzOiBbbGlzdGluZ0lkXVxuICAgIH0pO1xuICAgIHR4LnNldEdhc0xpbWl0TXVsdGlwbGUoMS4yKTtcbiAgICByZXR1cm4gdHg7XG4gIH0pO1xuXG4gIC8qKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICogUFJJVkFURSBGVU5DVElPTlNcbiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbiAgLyoqXG4gICAqIFRocm93cyBlcnJvciBpZiBsaXN0aW5nIGNvdWxkIG5vdCBiZSBmb3VuZFxuICAgKlxuICAgKiBAcGFyYW0gbGlzdGluZ0lkIC0gTGlzdGluZyB0byBjaGVjayBmb3JcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlTGlzdGluZyhsaXN0aW5nSWQpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0TGlzdGluZyhsaXN0aW5nSWQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZ2V0dGluZyB0aGUgbGlzdGluZyB3aXRoIGlkICR7bGlzdGluZ0lkfWApO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgbWV0aG9kIG1hcHMgdGhlIGF1Y3Rpb24gbGlzdGluZyB0byB0aGUgZGlyZWN0IGxpc3RpbmcgaW50ZXJmYWNlLlxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICogQHBhcmFtIGxpc3RpbmcgLSBUaGUgbGlzdGluZyB0byBtYXAsIGFzIHJldHVybmVkIGZyb20gdGhlIGNvbnRyYWN0LlxuICAgKiBAcmV0dXJucyAgVGhlIG1hcHBlZCBpbnRlcmZhY2UuXG4gICAqL1xuICBhc3luYyBtYXBMaXN0aW5nKGxpc3RpbmcpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYXNzZXRDb250cmFjdEFkZHJlc3M6IGxpc3RpbmcuYXNzZXRDb250cmFjdCxcbiAgICAgIGJ1eW91dFByaWNlOiBCaWdOdW1iZXIuZnJvbShsaXN0aW5nLmJ1eW91dFByaWNlUGVyVG9rZW4pLFxuICAgICAgY3VycmVuY3lDb250cmFjdEFkZHJlc3M6IGxpc3RpbmcuY3VycmVuY3ksXG4gICAgICBidXlvdXRDdXJyZW5jeVZhbHVlUGVyVG9rZW46IGF3YWl0IGZldGNoQ3VycmVuY3lWYWx1ZSh0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBsaXN0aW5nLmN1cnJlbmN5LCBsaXN0aW5nLmJ1eW91dFByaWNlUGVyVG9rZW4pLFxuICAgICAgaWQ6IGxpc3RpbmcubGlzdGluZ0lkLnRvU3RyaW5nKCksXG4gICAgICB0b2tlbklkOiBsaXN0aW5nLnRva2VuSWQsXG4gICAgICBxdWFudGl0eTogbGlzdGluZy5xdWFudGl0eSxcbiAgICAgIHN0YXJ0VGltZUluU2Vjb25kczogbGlzdGluZy5zdGFydFRpbWUsXG4gICAgICBhc3NldDogYXdhaXQgZmV0Y2hUb2tlbk1ldGFkYXRhRm9yQ29udHJhY3QobGlzdGluZy5hc3NldENvbnRyYWN0LCB0aGlzLmNvbnRyYWN0V3JhcHBlci5nZXRQcm92aWRlcigpLCBsaXN0aW5nLnRva2VuSWQsIHRoaXMuc3RvcmFnZSksXG4gICAgICBzZWNvbmRzVW50aWxFbmQ6IGxpc3RpbmcuZW5kVGltZSxcbiAgICAgIHNlbGxlckFkZHJlc3M6IGxpc3RpbmcudG9rZW5Pd25lcixcbiAgICAgIHR5cGU6IExpc3RpbmdUeXBlLkRpcmVjdFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVXNlIHRoaXMgbWV0aG9kIHRvIGNoZWNrIGlmIGEgZGlyZWN0IGxpc3RpbmcgaXMgc3RpbGwgdmFsaWQuXG4gICAqXG4gICAqIFdheXMgYSBkaXJlY3QgbGlzdGluZyBjYW4gYmVjb21lIGludmFsaWQ6XG4gICAqIDEuIFRoZSBhc3NldCBob2xkZXIgdHJhbnNmZXJyZWQgdGhlIGFzc2V0IHRvIGFub3RoZXIgd2FsbGV0XG4gICAqIDIuIFRoZSBhc3NldCBob2xkZXIgYnVybmVkIHRoZSBhc3NldFxuICAgKiAzLiBUaGUgYXNzZXQgaG9sZGVyIHJlbW92ZWQgdGhlIGFwcHJvdmFsIG9uIHRoZSBtYXJrZXRwbGFjZVxuICAgKlxuICAgKiBAaW50ZXJuYWxcbiAgICogQHBhcmFtIGxpc3RpbmcgLSBUaGUgbGlzdGluZyB0byBjaGVjay5cbiAgICogQHJldHVybnMgIFRydWUgaWYgdGhlIGxpc3RpbmcgaXMgdmFsaWQsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIGFzeW5jIGlzU3RpbGxWYWxpZExpc3RpbmcobGlzdGluZywgcXVhbnRpdHkpIHtcbiAgICBjb25zdCBhcHByb3ZlZCA9IGF3YWl0IGlzVG9rZW5BcHByb3ZlZEZvclRyYW5zZmVyKHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCksIHRoaXMuZ2V0QWRkcmVzcygpLCBsaXN0aW5nLmFzc2V0Q29udHJhY3RBZGRyZXNzLCBsaXN0aW5nLnRva2VuSWQsIGxpc3Rpbmcuc2VsbGVyQWRkcmVzcyk7XG4gICAgaWYgKCFhcHByb3ZlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjogYFRva2VuICcke2xpc3RpbmcudG9rZW5JZH0nIGZyb20gY29udHJhY3QgJyR7bGlzdGluZy5hc3NldENvbnRyYWN0QWRkcmVzc30nIGlzIG5vdCBhcHByb3ZlZCBmb3IgdHJhbnNmZXJgXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFByb3ZpZGVyKCk7XG4gICAgY29uc3QgRVJDMTY1QWJpID0gKGF3YWl0IGltcG9ydCgnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lFUkMxNjUuanNvbicpKS5kZWZhdWx0O1xuICAgIGNvbnN0IGVyYzE2NSA9IG5ldyBDb250cmFjdChsaXN0aW5nLmFzc2V0Q29udHJhY3RBZGRyZXNzLCBFUkMxNjVBYmksIHByb3ZpZGVyKTtcbiAgICBjb25zdCBpc0VSQzcyMSA9IGF3YWl0IGVyYzE2NS5zdXBwb3J0c0ludGVyZmFjZShJbnRlcmZhY2VJZF9JRVJDNzIxKTtcbiAgICBjb25zdCBpc0VSQzExNTUgPSBhd2FpdCBlcmMxNjUuc3VwcG9ydHNJbnRlcmZhY2UoSW50ZXJmYWNlSWRfSUVSQzExNTUpO1xuICAgIGlmIChpc0VSQzcyMSkge1xuICAgICAgY29uc3QgRVJDNzIxQWJpID0gKGF3YWl0IGltcG9ydCgnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lFUkM3MjEuanNvbicpKS5kZWZhdWx0O1xuICAgICAgY29uc3QgYXNzZXQgPSBuZXcgQ29udHJhY3QobGlzdGluZy5hc3NldENvbnRyYWN0QWRkcmVzcywgRVJDNzIxQWJpLCBwcm92aWRlcik7XG5cbiAgICAgIC8vIEhhbmRsZSByZXZlcnRzIGluIGNhc2Ugb2Ygbm9uLWV4aXN0ZW50IHRva2Vuc1xuICAgICAgbGV0IG93bmVyO1xuICAgICAgdHJ5IHtcbiAgICAgICAgb3duZXIgPSBhd2FpdCBhc3NldC5vd25lck9mKGxpc3RpbmcudG9rZW5JZCk7XG4gICAgICB9IGNhdGNoIChlKSB7fVxuICAgICAgY29uc3QgdmFsaWQgPSBvd25lcj8udG9Mb3dlckNhc2UoKSA9PT0gbGlzdGluZy5zZWxsZXJBZGRyZXNzLnRvTG93ZXJDYXNlKCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWxpZCxcbiAgICAgICAgZXJyb3I6IHZhbGlkID8gdW5kZWZpbmVkIDogYFNlbGxlciBpcyBub3QgdGhlIG93bmVyIG9mIFRva2VuICcke2xpc3RpbmcudG9rZW5JZH0nIGZyb20gY29udHJhY3QgJyR7bGlzdGluZy5hc3NldENvbnRyYWN0QWRkcmVzc30gYW55bW9yZSdgXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAoaXNFUkMxMTU1KSB7XG4gICAgICBjb25zdCBFUkMxMTU1QWJpID0gKGF3YWl0IGltcG9ydCgnQHRoaXJkd2ViLWRldi9jb250cmFjdHMtanMvZGlzdC9hYmlzL0lFUkMxMTU1Lmpzb24nKSkuZGVmYXVsdDtcbiAgICAgIGNvbnN0IGFzc2V0ID0gbmV3IENvbnRyYWN0KGxpc3RpbmcuYXNzZXRDb250cmFjdEFkZHJlc3MsIEVSQzExNTVBYmksIHByb3ZpZGVyKTtcbiAgICAgIGNvbnN0IGJhbGFuY2UgPSBhd2FpdCBhc3NldC5iYWxhbmNlT2YobGlzdGluZy5zZWxsZXJBZGRyZXNzLCBsaXN0aW5nLnRva2VuSWQpO1xuICAgICAgY29uc3QgdmFsaWQgPSBiYWxhbmNlLmd0ZShxdWFudGl0eSB8fCBsaXN0aW5nLnF1YW50aXR5KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbGlkLFxuICAgICAgICBlcnJvcjogdmFsaWQgPyB1bmRlZmluZWQgOiBgU2VsbGVyIGRvZXMgbm90IGhhdmUgZW5vdWdoIGJhbGFuY2Ugb2YgVG9rZW4gJyR7bGlzdGluZy50b2tlbklkfScgZnJvbSBjb250cmFjdCAnJHtsaXN0aW5nLmFzc2V0Q29udHJhY3RBZGRyZXNzfSB0byBmdWxmaWxsIHRoZSBsaXN0aW5nYFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjogXCJDb250cmFjdCBkb2VzIG5vdCBpbXBsZW1lbnQgRVJDIDExNTUgb3IgRVJDIDcyMS5cIlxuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgeW91ciBvd24gd2hpdGVsYWJlbCBtYXJrZXRwbGFjZSB0aGF0IGVuYWJsZXMgdXNlcnMgdG8gYnV5IGFuZCBzZWxsIGFueSBkaWdpdGFsIGFzc2V0cy5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIGltcG9ydCB7IFRoaXJkd2ViU0RLIH0gZnJvbSBcIkB0aGlyZHdlYi1kZXYvc2RrXCI7XG4gKlxuICogY29uc3Qgc2RrID0gbmV3IFRoaXJkd2ViU0RLKFwie3tjaGFpbk5hbWV9fVwiKTtcbiAqIGNvbnN0IGNvbnRyYWN0ID0gYXdhaXQgc2RrLmdldENvbnRyYWN0KFwie3tjb250cmFjdF9hZGRyZXNzfX1cIiwgXCJtYXJrZXRwbGFjZVwiKTtcbiAqIGBgYFxuICpcbiAqIEBpbnRlcm5hbFxuICogQGRlcHJlY2F0ZWQgdXNlIGNvbnRyYWN0LmRpcmVjdExpc3RpbmdzIC8gY29udHJhY3QuYXVjdGlvbnMgLyBjb250cmFjdC5vZmZlcnMgaW5zdGVhZFxuICovXG5jbGFzcyBNYXJrZXRwbGFjZSB7XG4gIHN0YXRpYyBjb250cmFjdFJvbGVzID0gTUFSS0VUUExBQ0VfQ09OVFJBQ1RfUk9MRVM7XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cblxuICAvKipcbiAgICogRGlyZWN0IGxpc3RpbmdzXG4gICAqIEByZW1hcmtzIENyZWF0ZSBhbmQgbWFuYWdlIGRpcmVjdCBsaXN0aW5ncyBpbiB5b3VyIG1hcmtldHBsYWNlLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIERhdGEgb2YgdGhlIGxpc3RpbmcgeW91IHdhbnQgdG8gY3JlYXRlXG4gICAqIGNvbnN0IGxpc3RpbmcgPSB7XG4gICAqICAgLy8gYWRkcmVzcyBvZiB0aGUgTkZUIGNvbnRyYWN0IHRoZSBhc3NldCB5b3Ugd2FudCB0byBsaXN0IGlzIG9uXG4gICAqICAgYXNzZXRDb250cmFjdEFkZHJlc3M6IFwiMHguLi5cIixcbiAgICogICAvLyB0b2tlbiBJRCBvZiB0aGUgYXNzZXQgeW91IHdhbnQgdG8gbGlzdFxuICAgKiAgIHRva2VuSWQ6IFwiMFwiLFxuICAgKiAgLy8gd2hlbiBzaG91bGQgdGhlIGxpc3Rpbmcgb3BlbiB1cCBmb3Igb2ZmZXJzXG4gICAqICAgc3RhcnRUaW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAqICAgLy8gaG93IGxvbmcgdGhlIGxpc3Rpbmcgd2lsbCBiZSBvcGVuIGZvclxuICAgKiAgIGxpc3RpbmdEdXJhdGlvbkluU2Vjb25kczogODY0MDAsXG4gICAqICAgLy8gaG93IG1hbnkgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGxpc3RcbiAgICogICBxdWFudGl0eTogMSxcbiAgICogICAvLyBhZGRyZXNzIG9mIHRoZSBjdXJyZW5jeSBjb250cmFjdCB0aGF0IHdpbGwgYmUgdXNlZCB0byBwYXkgZm9yIHRoZSBsaXN0aW5nXG4gICAqICAgY3VycmVuY3lDb250cmFjdEFkZHJlc3M6IE5BVElWRV9UT0tFTl9BRERSRVNTLFxuICAgKiAgIC8vIGhvdyBtdWNoIHRoZSBhc3NldCB3aWxsIGJlIHNvbGQgZm9yXG4gICAqICAgYnV5b3V0UHJpY2VQZXJUb2tlbjogXCIxLjVcIixcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB0eCA9IGF3YWl0IGNvbnRyYWN0LmRpcmVjdC5jcmVhdGVMaXN0aW5nKGxpc3RpbmcpO1xuICAgKiBjb25zdCByZWNlaXB0ID0gdHgucmVjZWlwdDsgLy8gdGhlIHRyYW5zYWN0aW9uIHJlY2VpcHRcbiAgICogY29uc3QgbGlzdGluZ0lkID0gdHguaWQ7IC8vIHRoZSBpZCBvZiB0aGUgbmV3bHkgY3JlYXRlZCBsaXN0aW5nXG4gICAqXG4gICAqIC8vIEFuZCBvbiB0aGUgYnV5ZXJzIHNpZGU6XG4gICAqIC8vIFF1YW50aXR5IG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBidXlcbiAgICogY29uc3QgcXVhbnRpdHlEZXNpcmVkID0gMTtcbiAgICogYXdhaXQgY29udHJhY3QuZGlyZWN0LmJ1eW91dExpc3RpbmcobGlzdGluZ0lkLCBxdWFudGl0eURlc2lyZWQpO1xuICAgKiBgYGBcbiAgICovXG5cbiAgLyoqXG4gICAqIEF1Y3Rpb25zXG4gICAqIEByZW1hcmtzIENyZWF0ZSBhbmQgbWFuYWdlIGF1Y3Rpb25zIGluIHlvdXIgbWFya2V0cGxhY2UuXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gRGF0YSBvZiB0aGUgYXVjdGlvbiB5b3Ugd2FudCB0byBjcmVhdGVcbiAgICogY29uc3QgYXVjdGlvbiA9IHtcbiAgICogICAvLyBhZGRyZXNzIG9mIHRoZSBjb250cmFjdCB0aGUgYXNzZXQgeW91IHdhbnQgdG8gbGlzdCBpcyBvblxuICAgKiAgIGFzc2V0Q29udHJhY3RBZGRyZXNzOiBcIjB4Li4uXCIsXG4gICAqICAgLy8gdG9rZW4gSUQgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGxpc3RcbiAgICogICB0b2tlbklkOiBcIjBcIixcbiAgICogIC8vIHdoZW4gc2hvdWxkIHRoZSBsaXN0aW5nIG9wZW4gdXAgZm9yIG9mZmVyc1xuICAgKiAgIHN0YXJ0VGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgKiAgIC8vIGhvdyBsb25nIHRoZSBsaXN0aW5nIHdpbGwgYmUgb3BlbiBmb3JcbiAgICogICBsaXN0aW5nRHVyYXRpb25JblNlY29uZHM6IDg2NDAwLFxuICAgKiAgIC8vIGhvdyBtYW55IG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBsaXN0XG4gICAqICAgcXVhbnRpdHk6IDEsXG4gICAqICAgLy8gYWRkcmVzcyBvZiB0aGUgY3VycmVuY3kgY29udHJhY3QgdGhhdCB3aWxsIGJlIHVzZWQgdG8gcGF5IGZvciB0aGUgbGlzdGluZ1xuICAgKiAgIGN1cnJlbmN5Q29udHJhY3RBZGRyZXNzOiBOQVRJVkVfVE9LRU5fQUREUkVTUyxcbiAgICogICAvLyBob3cgbXVjaCBwZW9wbGUgd291bGQgaGF2ZSB0byBiaWQgdG8gaW5zdGFudGx5IGJ1eSB0aGUgYXNzZXRcbiAgICogICBidXlvdXRQcmljZVBlclRva2VuOiBcIjEwXCIsXG4gICAqICAgLy8gdGhlIG1pbmltdW0gYmlkIHRoYXQgd2lsbCBiZSBhY2NlcHRlZCBmb3IgdGhlIHRva2VuXG4gICAqICAgcmVzZXJ2ZVByaWNlUGVyVG9rZW46IFwiMS41XCIsXG4gICAqIH1cbiAgICpcbiAgICogY29uc3QgdHggPSBhd2FpdCBjb250cmFjdC5hdWN0aW9uLmNyZWF0ZUxpc3RpbmcoYXVjdGlvbik7XG4gICAqIGNvbnN0IHJlY2VpcHQgPSB0eC5yZWNlaXB0OyAvLyB0aGUgdHJhbnNhY3Rpb24gcmVjZWlwdFxuICAgKiBjb25zdCBsaXN0aW5nSWQgPSB0eC5pZDsgLy8gdGhlIGlkIG9mIHRoZSBuZXdseSBjcmVhdGVkIGxpc3RpbmdcbiAgICpcbiAgICogLy8gQW5kIG9uIHRoZSBidXllcnMgc2lkZTpcbiAgICogLy8gVGhlIHByaWNlIHlvdSBhcmUgd2lsbGluZyB0byBiaWQgZm9yIGEgc2luZ2xlIHRva2VuIG9mIHRoZSBsaXN0aW5nXG4gICAqIGNvbnN0IHByaWNlUGVyVG9rZW4gPSAyLjY7XG4gICAqIGF3YWl0IGNvbnRyYWN0LmF1Y3Rpb24ubWFrZUJpZChsaXN0aW5nSWQsIHByaWNlUGVyVG9rZW4pO1xuICAgKiBgYGBcbiAgICovXG5cbiAgZ2V0IGNoYWluSWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NoYWluSWQ7XG4gIH1cbiAgY29uc3RydWN0b3IobmV0d29yaywgYWRkcmVzcywgc3RvcmFnZSkge1xuICAgIGxldCBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiB7fTtcbiAgICBsZXQgYWJpID0gYXJndW1lbnRzLmxlbmd0aCA+IDQgPyBhcmd1bWVudHNbNF0gOiB1bmRlZmluZWQ7XG4gICAgbGV0IGNoYWluSWQgPSBhcmd1bWVudHMubGVuZ3RoID4gNSA/IGFyZ3VtZW50c1s1XSA6IHVuZGVmaW5lZDtcbiAgICBsZXQgY29udHJhY3RXcmFwcGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDYgJiYgYXJndW1lbnRzWzZdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNl0gOiBuZXcgQ29udHJhY3RXcmFwcGVyKG5ldHdvcmssIGFkZHJlc3MsIGFiaSwgb3B0aW9ucywgc3RvcmFnZSk7XG4gICAgdGhpcy5fY2hhaW5JZCA9IGNoYWluSWQ7XG4gICAgdGhpcy5hYmkgPSBBYmlTY2hlbWEucGFyc2UoYWJpIHx8IFtdKTtcbiAgICB0aGlzLmNvbnRyYWN0V3JhcHBlciA9IGNvbnRyYWN0V3JhcHBlcjtcbiAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMubWV0YWRhdGEgPSBuZXcgQ29udHJhY3RNZXRhZGF0YSh0aGlzLmNvbnRyYWN0V3JhcHBlciwgTWFya2V0cGxhY2VDb250cmFjdFNjaGVtYSwgdGhpcy5zdG9yYWdlKTtcbiAgICB0aGlzLmFwcCA9IG5ldyBDb250cmFjdEFwcFVSSSh0aGlzLmNvbnRyYWN0V3JhcHBlciwgdGhpcy5tZXRhZGF0YSwgdGhpcy5zdG9yYWdlKTtcbiAgICB0aGlzLnJvbGVzID0gbmV3IENvbnRyYWN0Um9sZXModGhpcy5jb250cmFjdFdyYXBwZXIsIE1hcmtldHBsYWNlLmNvbnRyYWN0Um9sZXMpO1xuICAgIHRoaXMuZW5jb2RlciA9IG5ldyBDb250cmFjdEVuY29kZXIodGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMuZXN0aW1hdG9yID0gbmV3IEdhc0Nvc3RFc3RpbWF0b3IodGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMuZGlyZWN0ID0gbmV3IE1hcmtldHBsYWNlRGlyZWN0KHRoaXMuY29udHJhY3RXcmFwcGVyLCB0aGlzLnN0b3JhZ2UpO1xuICAgIHRoaXMuYXVjdGlvbiA9IG5ldyBNYXJrZXRwbGFjZUF1Y3Rpb24odGhpcy5jb250cmFjdFdyYXBwZXIsIHRoaXMuc3RvcmFnZSk7XG4gICAgdGhpcy5ldmVudHMgPSBuZXcgQ29udHJhY3RFdmVudHModGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMucGxhdGZvcm1GZWVzID0gbmV3IENvbnRyYWN0UGxhdGZvcm1GZWUodGhpcy5jb250cmFjdFdyYXBwZXIpO1xuICAgIHRoaXMuaW50ZXJjZXB0b3IgPSBuZXcgQ29udHJhY3RJbnRlcmNlcHRvcih0aGlzLmNvbnRyYWN0V3JhcHBlcik7XG4gIH1cbiAgb25OZXR3b3JrVXBkYXRlZChuZXR3b3JrKSB7XG4gICAgdGhpcy5jb250cmFjdFdyYXBwZXIudXBkYXRlU2lnbmVyT3JQcm92aWRlcihuZXR3b3JrKTtcbiAgfVxuICBnZXRBZGRyZXNzKCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRyYWN0V3JhcHBlci5hZGRyZXNzO1xuICB9XG5cbiAgLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBSRUFEIEZVTkNUSU9OU1xuICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICAvKipcbiAgICogQ29udmVuaWVuY2UgZnVuY3Rpb24gdG8gZ2V0IGVpdGhlciBhIGRpcmVjdCBvciBhdWN0aW9uIGxpc3RpbmdcbiAgICpcbiAgICogQHBhcmFtIGxpc3RpbmdJZCAtIHRoZSBsaXN0aW5nIGlkXG4gICAqIEByZXR1cm5zIGVpdGhlciBhIGRpcmVjdCBvciBhdWN0aW9uIGxpc3RpbmdcbiAgICpcbiAgICogQHJlbWFya3MgR2V0IGEgbGlzdGluZyBieSBpdHMgbGlzdGluZyBpZFxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IGxpc3RpbmdJZCA9IDA7XG4gICAqIGNvbnN0IGxpc3RpbmcgPSBhd2FpdCBjb250cmFjdC5nZXRMaXN0aW5nKGxpc3RpbmdJZCk7XG4gICAqIGBgYFxuICAgKi9cbiAgYXN5bmMgZ2V0TGlzdGluZyhsaXN0aW5nSWQpIHtcbiAgICBjb25zdCBsaXN0aW5nID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZChcImxpc3RpbmdzXCIsIFtsaXN0aW5nSWRdKTtcbiAgICBpZiAobGlzdGluZy5hc3NldENvbnRyYWN0ID09PSBjb25zdGFudHMuQWRkcmVzc1plcm8pIHtcbiAgICAgIHRocm93IG5ldyBMaXN0aW5nTm90Rm91bmRFcnJvcih0aGlzLmdldEFkZHJlc3MoKSwgbGlzdGluZ0lkLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBzd2l0Y2ggKGxpc3RpbmcubGlzdGluZ1R5cGUpIHtcbiAgICAgIGNhc2UgTGlzdGluZ1R5cGUuQXVjdGlvbjpcbiAgICAgICAge1xuICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmF1Y3Rpb24ubWFwTGlzdGluZyhsaXN0aW5nKTtcbiAgICAgICAgfVxuICAgICAgY2FzZSBMaXN0aW5nVHlwZS5EaXJlY3Q6XG4gICAgICAgIHtcbiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5kaXJlY3QubWFwTGlzdGluZyhsaXN0aW5nKTtcbiAgICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBsaXN0aW5nIHR5cGU6ICR7bGlzdGluZy5saXN0aW5nVHlwZX1gKTtcbiAgICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGFjdGl2ZSBsaXN0aW5nc1xuICAgKlxuICAgKiBAcmVtYXJrcyBGZXRjaCBhbGwgdGhlIGFjdGl2ZSBsaXN0aW5ncyBmcm9tIHRoaXMgbWFya2V0cGxhY2UgY29udHJhY3QuIEFuIGFjdGl2ZSBsaXN0aW5nIG1lYW5zIGl0IGNhbiBiZSBib3VnaHQgb3IgYmlkIG9uLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IGxpc3RpbmdzID0gYXdhaXQgY29udHJhY3QuZ2V0QWN0aXZlTGlzdGluZ3MoKTtcbiAgICogY29uc3QgcHJpY2VPZkZpcnN0QWN0aXZlTGlzdGluZyA9IGxpc3RpbmdzWzBdLnByaWNlO1xuICAgKiBgYGBcbiAgICogQHBhcmFtIGZpbHRlciAtIG9wdGlvbmFsIGZpbHRlciBwYXJhbWV0ZXJzXG4gICAqL1xuICBhc3luYyBnZXRBY3RpdmVMaXN0aW5ncyhmaWx0ZXIpIHtcbiAgICBjb25zdCByYXdMaXN0aW5ncyA9IGF3YWl0IHRoaXMuZ2V0QWxsTGlzdGluZ3NOb0ZpbHRlcih0cnVlKTtcbiAgICBjb25zdCBmaWx0ZXJlZCA9IHRoaXMuYXBwbHlGaWx0ZXIocmF3TGlzdGluZ3MsIGZpbHRlcik7XG4gICAgY29uc3Qgbm93ID0gQmlnTnVtYmVyLmZyb20oTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkpO1xuICAgIHJldHVybiBmaWx0ZXJlZC5maWx0ZXIobCA9PiB7XG4gICAgICByZXR1cm4gbC50eXBlID09PSBMaXN0aW5nVHlwZS5BdWN0aW9uICYmIEJpZ051bWJlci5mcm9tKGwuZW5kVGltZUluRXBvY2hTZWNvbmRzKS5ndChub3cpICYmIEJpZ051bWJlci5mcm9tKGwuc3RhcnRUaW1lSW5FcG9jaFNlY29uZHMpLmx0ZShub3cpIHx8IGwudHlwZSA9PT0gTGlzdGluZ1R5cGUuRGlyZWN0ICYmIEJpZ051bWJlci5mcm9tKGwucXVhbnRpdHkpLmd0KDApO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgdGhlIGxpc3RpbmdzXG4gICAqXG4gICAqIEByZW1hcmtzIEZldGNoIGFsbCB0aGUgbGlzdGluZ3MgZnJvbSB0aGlzIG1hcmtldHBsYWNlIGNvbnRyYWN0LCBpbmNsdWRpbmcgc29sZCBvbmVzLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIGNvbnN0IGxpc3RpbmdzID0gYXdhaXQgY29udHJhY3QuZ2V0QWxsTGlzdGluZ3MoKTtcbiAgICogY29uc3QgcHJpY2VPZkZpcnN0TGlzdGluZyA9IGxpc3RpbmdzWzBdLnByaWNlO1xuICAgKiBgYGBcbiAgICpcbiAgICogQHBhcmFtIGZpbHRlciAtIG9wdGlvbmFsIGZpbHRlciBwYXJhbWV0ZXJzXG4gICAqL1xuICBhc3luYyBnZXRBbGxMaXN0aW5ncyhmaWx0ZXIpIHtcbiAgICBjb25zdCByYXdMaXN0aW5ncyA9IGF3YWl0IHRoaXMuZ2V0QWxsTGlzdGluZ3NOb0ZpbHRlcihmYWxzZSk7XG4gICAgcmV0dXJuIHRoaXMuYXBwbHlGaWx0ZXIocmF3TGlzdGluZ3MsIGZpbHRlcik7XG4gIH1cblxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBnZXRBbGwgPSB0aGlzLmdldEFsbExpc3RpbmdzO1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRvdGFsIG51bWJlciBvZiBMaXN0aW5nc1xuICAgKiBAcmV0dXJucyBUaGUgdG90YWwgbnVtYmVyIGxpc3RpbmdzIG9uIHRoZSBtYXJrZXRwbGFjZVxuICAgKiBAcHVibGljXG4gICAqL1xuICBhc3luYyBnZXRUb3RhbENvdW50KCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkKFwidG90YWxMaXN0aW5nc1wiLCBbXSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHdoZXRoZXIgbGlzdGluZyBpcyByZXN0cmljdGVkIG9ubHkgdG8gYWRkcmVzc2VzIHdpdGggdGhlIExpc3RlciByb2xlXG4gICAqL1xuICBhc3luYyBpc1Jlc3RyaWN0ZWRUb0xpc3RlclJvbGVPbmx5KCkge1xuICAgIGNvbnN0IGFueW9uZUNhbkxpc3QgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkKFwiaGFzUm9sZVwiLCBbZ2V0Um9sZUhhc2goXCJsaXN0ZXJcIiksIGNvbnN0YW50cy5BZGRyZXNzWmVyb10pO1xuICAgIHJldHVybiAhYW55b25lQ2FuTGlzdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGJ1ZmZlciBpbiBiYXNpcyBwb2ludHMgYmV0d2VlbiBvZmZlcnNcbiAgICovXG4gIGFzeW5jIGdldEJpZEJ1ZmZlckJwcygpIHtcbiAgICByZXR1cm4gdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZChcImJpZEJ1ZmZlckJwc1wiLCBbXSk7XG4gIH1cblxuICAvKipcbiAgICogZ2V0IHRoZSBidWZmZXIgdGltZSBpbiBzZWNvbmRzIGJldHdlZW4gb2ZmZXJzXG4gICAqL1xuICBhc3luYyBnZXRUaW1lQnVmZmVySW5TZWNvbmRzKCkge1xuICAgIHJldHVybiB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkKFwidGltZUJ1ZmZlclwiLCBbXSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCB0aGUgb2ZmZXJzIGZvciBhIGxpc3RpbmdcbiAgICpcbiAgICogQHJlbWFya3MgRmV0Y2ggYWxsIHRoZSBvZmZlcnMgZm9yIGEgc3BlY2lmaWVkIGRpcmVjdCBvciBhdWN0aW9uIGxpc3RpbmcuXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogY29uc3Qgb2ZmZXJzID0gYXdhaXQgbWFya2V0cGxhY2VDb250cmFjdC5nZXRPZmZlcnMobGlzdGluZ0lkKTtcbiAgICogY29uc3QgZmlyc3RPZmZlciA9IG9mZmVyc1swXTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSBsaXN0aW5nSWQgLSB0aGUgaWQgb2YgdGhlIGxpc3RpbmcgdG8gZmV0Y2ggb2ZmZXJzIGZvclxuICAgKi9cbiAgYXN5bmMgZ2V0T2ZmZXJzKGxpc3RpbmdJZCkge1xuICAgIC8vIGdldCBhbGwgbmV3IG9mZmVyIGV2ZW50cyBmcm9tIHRoaXMgY29udHJhY3RcbiAgICBjb25zdCBsaXN0aW5nRXZlbnRzID0gYXdhaXQgdGhpcy5ldmVudHMuZ2V0RXZlbnRzKFwiTmV3T2ZmZXJcIiwge1xuICAgICAgb3JkZXI6IFwiZGVzY1wiLFxuICAgICAgZmlsdGVyczoge1xuICAgICAgICBsaXN0aW5nSWRcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBkZXJpdmUgdGhlIG9mZmVycyBmcm9tIHRoZSBldmVudHNcbiAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwobGlzdGluZ0V2ZW50cy5tYXAoZSA9PiB7XG4gICAgICByZXR1cm4gbWFwT2ZmZXIodGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0UHJvdmlkZXIoKSwgQmlnTnVtYmVyLmZyb20obGlzdGluZ0lkKSwge1xuICAgICAgICBxdWFudGl0eVdhbnRlZDogZS5kYXRhLnF1YW50aXR5V2FudGVkLFxuICAgICAgICBwcmljZVBlclRva2VuOiBlLmRhdGEucXVhbnRpdHlXYW50ZWQuZ3QoMCkgPyBlLmRhdGEudG90YWxPZmZlckFtb3VudC5kaXYoZS5kYXRhLnF1YW50aXR5V2FudGVkKSA6IGUuZGF0YS50b3RhbE9mZmVyQW1vdW50LFxuICAgICAgICBjdXJyZW5jeTogZS5kYXRhLmN1cnJlbmN5LFxuICAgICAgICBvZmZlcm9yOiBlLmRhdGEub2ZmZXJvclxuICAgICAgfSk7XG4gICAgfSkpO1xuICB9XG5cbiAgLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBXUklURSBGVU5DVElPTlNcbiAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbiAgLyoqXG4gICAqIFB1cmNoYXNlIE5GVHNcbiAgICogQHJlbWFya3MgQnV5IGEgRGlyZWN0IG9yIEF1Y3Rpb24gbGlzdGluZyBvbiB5b3VyIG1hcmtldHBsYWNlLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIFRoZSBsaXN0aW5nIElEIG9mIHRoZSBhc3NldCB5b3Ugd2FudCB0byBidXlcbiAgICogY29uc3QgbGlzdGluZ0lkID0gMDtcbiAgICogLy8gUXVhbnRpdHkgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIGJ1eVxuICAgKiBjb25zdCBxdWFudGl0eURlc2lyZWQgPSAxO1xuICAgKlxuICAgKiBhd2FpdCBjb250cmFjdC5idXlvdXRMaXN0aW5nKGxpc3RpbmdJZCwgcXVhbnRpdHlEZXNpcmVkKTtcbiAgICogYGBgXG4gICAqIEBwYXJhbSBsaXN0aW5nSWQgLSB0aGUgbGlzdGluZyBJRCBvZiB0aGUgbGlzdGluZyB5b3Ugd2FudCB0byBidXlcbiAgICogQHBhcmFtIHF1YW50aXR5RGVzaXJlZCAtIHRoZSBxdWFudGl0eSB0aGF0IHlvdSB3YW50IHRvIGJ1eSAoZm9yIEVSQzExNTUgdG9rZW5zKVxuICAgKiBAcGFyYW0gcmVjZWl2ZXIgLSBvcHRpb25hbCByZWNlaXZlciBvZiB0aGUgYm91Z2h0IGxpc3RpbmcgaWYgZGlmZmVyZW50IGZyb20gdGhlIGNvbm5lY3RlZCB3YWxsZXQgKGZvciBkaXJlY3QgbGlzdGluZ3Mgb25seSlcbiAgICovXG4gIGJ1eW91dExpc3RpbmcgPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgKGxpc3RpbmdJZCwgcXVhbnRpdHlEZXNpcmVkLCByZWNlaXZlcikgPT4ge1xuICAgIGNvbnN0IGxpc3RpbmcgPSBhd2FpdCB0aGlzLmNvbnRyYWN0V3JhcHBlci5yZWFkKFwibGlzdGluZ3NcIiwgW2xpc3RpbmdJZF0pO1xuICAgIGlmIChsaXN0aW5nLmxpc3RpbmdJZC50b1N0cmluZygpICE9PSBsaXN0aW5nSWQudG9TdHJpbmcoKSkge1xuICAgICAgdGhyb3cgbmV3IExpc3RpbmdOb3RGb3VuZEVycm9yKHRoaXMuZ2V0QWRkcmVzcygpLCBsaXN0aW5nSWQudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIHN3aXRjaCAobGlzdGluZy5saXN0aW5nVHlwZSkge1xuICAgICAgY2FzZSBMaXN0aW5nVHlwZS5EaXJlY3Q6XG4gICAgICAgIHtcbiAgICAgICAgICBpbnZhcmlhbnQocXVhbnRpdHlEZXNpcmVkICE9PSB1bmRlZmluZWQsIFwicXVhbnRpdHlEZXNpcmVkIGlzIHJlcXVpcmVkIHdoZW4gYnV5aW5nIG91dCBhIGRpcmVjdCBsaXN0aW5nXCIpO1xuICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmRpcmVjdC5idXlvdXRMaXN0aW5nLnByZXBhcmUobGlzdGluZ0lkLCBxdWFudGl0eURlc2lyZWQsIHJlY2VpdmVyKTtcbiAgICAgICAgfVxuICAgICAgY2FzZSBMaXN0aW5nVHlwZS5BdWN0aW9uOlxuICAgICAgICB7XG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuYXVjdGlvbi5idXlvdXRMaXN0aW5nLnByZXBhcmUobGlzdGluZ0lkKTtcbiAgICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgRXJyb3IoYFVua25vd24gbGlzdGluZyB0eXBlOiAke2xpc3RpbmcubGlzdGluZ1R5cGV9YCk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogTWFrZSBhbiBvZmZlciBmb3IgYSBEaXJlY3Qgb3IgQXVjdGlvbiBMaXN0aW5nXG4gICAqXG4gICAqIEByZW1hcmtzIE1ha2UgYW4gb2ZmZXIgb24gYSBkaXJlY3Qgb3IgYXVjdGlvbiBsaXN0aW5nXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYGphdmFzY3JpcHRcbiAgICogLy8gVGhlIGxpc3RpbmcgSUQgb2YgdGhlIGFzc2V0IHlvdSB3YW50IHRvIG9mZmVyIG9uXG4gICAqIGNvbnN0IGxpc3RpbmdJZCA9IDA7XG4gICAqIC8vIFRoZSBwcmljZSB5b3UgYXJlIHdpbGxpbmcgdG8gb2ZmZXIgcGVyIHRva2VuXG4gICAqIGNvbnN0IHByaWNlUGVyVG9rZW4gPSAwLjU7XG4gICAqIC8vIFRoZSBxdWFudGl0eSBvZiB0b2tlbnMgeW91IHdhbnQgdG8gcmVjZWl2ZSBmb3IgdGhpcyBvZmZlclxuICAgKiBjb25zdCBxdWFudGl0eSA9IDE7XG4gICAqXG4gICAqIGF3YWl0IGNvbnRyYWN0Lm1ha2VPZmZlcihcbiAgICogICBsaXN0aW5nSWQsXG4gICAqICAgcHJpY2VQZXJUb2tlbixcbiAgICogICBxdWFudGl0eSxcbiAgICogKTtcbiAgICogYGBgXG4gICAqL1xuICBtYWtlT2ZmZXIgPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgKGxpc3RpbmdJZCwgcHJpY2VQZXJUb2tlbiwgcXVhbnRpdHkpID0+IHtcbiAgICBjb25zdCBsaXN0aW5nID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZChcImxpc3RpbmdzXCIsIFtsaXN0aW5nSWRdKTtcbiAgICBpZiAobGlzdGluZy5saXN0aW5nSWQudG9TdHJpbmcoKSAhPT0gbGlzdGluZ0lkLnRvU3RyaW5nKCkpIHtcbiAgICAgIHRocm93IG5ldyBMaXN0aW5nTm90Rm91bmRFcnJvcih0aGlzLmdldEFkZHJlc3MoKSwgbGlzdGluZ0lkLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBjb25zdCBjaGFpbklkID0gYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0Q2hhaW5JRCgpO1xuICAgIHN3aXRjaCAobGlzdGluZy5saXN0aW5nVHlwZSkge1xuICAgICAgY2FzZSBMaXN0aW5nVHlwZS5EaXJlY3Q6XG4gICAgICAgIHtcbiAgICAgICAgICBpbnZhcmlhbnQocXVhbnRpdHksIFwicXVhbnRpdHkgaXMgcmVxdWlyZWQgd2hlbiBtYWtpbmcgYW4gb2ZmZXIgb24gYSBkaXJlY3QgbGlzdGluZ1wiKTtcbiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5kaXJlY3QubWFrZU9mZmVyLnByZXBhcmUobGlzdGluZ0lkLCBxdWFudGl0eSwgaXNOYXRpdmVUb2tlbihsaXN0aW5nLmN1cnJlbmN5KSA/IE5BVElWRV9UT0tFTlNbY2hhaW5JZF0ud3JhcHBlZC5hZGRyZXNzIDogbGlzdGluZy5jdXJyZW5jeSwgcHJpY2VQZXJUb2tlbik7XG4gICAgICAgIH1cbiAgICAgIGNhc2UgTGlzdGluZ1R5cGUuQXVjdGlvbjpcbiAgICAgICAge1xuICAgICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmF1Y3Rpb24ubWFrZUJpZC5wcmVwYXJlKGxpc3RpbmdJZCwgcHJpY2VQZXJUb2tlbik7XG4gICAgICAgIH1cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IEVycm9yKGBVbmtub3duIGxpc3RpbmcgdHlwZTogJHtsaXN0aW5nLmxpc3RpbmdUeXBlfWApO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgQXVjdGlvbiBiaWQgYnVmZmVyXG4gICAqIEByZW1hcmtzIEEgcGVyY2VudGFnZSAoZS5nLiA1JSkgaW4gYmFzaXMgcG9pbnRzICg1JSA9IDUwMCwgMTAwJSA9IDEwMDAwKS4gQSBuZXcgYmlkIGlzIGNvbnNpZGVyZWQgdG8gYmUgYSB3aW5uaW5nIGJpZCBvbmx5IGlmIGl0cyBiaWQgYW1vdW50IGlzIGF0IGxlYXN0IHRoZSBiaWQgYnVmZmVyIChlLmcuIDUlKSBncmVhdGVyIHRoYW4gdGhlIHByZXZpb3VzIHdpbm5pbmcgYmlkLiBUaGlzIHByZXZlbnRzIGJ1eWVycyBmcm9tIG1ha2luZyB2ZXJ5IHNsaWdodGx5IGhpZ2hlciBiaWRzIHRvIHdpbiB0aGUgYXVjdGlvbmVkIGl0ZW1zLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBqYXZhc2NyaXB0XG4gICAqIC8vIHRoZSBiaWQgYnVmZmVyIGluIGJhc2lzIHBvaW50c1xuICAgKiBjb25zdCBidWZmZXJCcHMgPSA1XzAwOyAvLyA1JVxuICAgKiBhd2FpdCBjb250cmFjdC5zZXRCaWRCdWZmZXJCcHMoYnVmZmVyQnBzKTtcbiAgICogYGBgXG4gICAqIEBwYXJhbSBidWZmZXJCcHMgLSB0aGUgYnBzIHZhbHVlXG4gICAqL1xuICBzZXRCaWRCdWZmZXJCcHMgPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgYnVmZmVyQnBzID0+IHtcbiAgICBhd2FpdCB0aGlzLnJvbGVzLnZlcmlmeShbXCJhZG1pblwiXSwgYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIuZ2V0U2lnbmVyQWRkcmVzcygpKTtcbiAgICBjb25zdCB0aW1lQnVmZmVyID0gYXdhaXQgdGhpcy5nZXRUaW1lQnVmZmVySW5TZWNvbmRzKCk7XG4gICAgcmV0dXJuIFRyYW5zYWN0aW9uLmZyb21Db250cmFjdFdyYXBwZXIoe1xuICAgICAgY29udHJhY3RXcmFwcGVyOiB0aGlzLmNvbnRyYWN0V3JhcHBlcixcbiAgICAgIG1ldGhvZDogXCJzZXRBdWN0aW9uQnVmZmVyc1wiLFxuICAgICAgYXJnczogW3RpbWVCdWZmZXIsIEJpZ051bWJlci5mcm9tKGJ1ZmZlckJwcyldXG4gICAgfSk7XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBTZXQgdGhlIEF1Y3Rpb24gVGltZSBidWZmZXI6XG4gICAqIEByZW1hcmtzIE1lYXN1cmVkIGluIHNlY29uZHMgKGUuZy4gMTUgbWludXRlcyBvciA5MDAgc2Vjb25kcykuIElmIGEgd2lubmluZyBiaWQgaXMgbWFkZSB3aXRoaW4gdGhlIGJ1ZmZlciBvZiB0aGUgYXVjdGlvbiBjbG9zaW5nIChlLmcuIDE1IG1pbnV0ZXMgd2l0aGluIHRoZSBhdWN0aW9uIGNsb3NpbmcpLCB0aGUgYXVjdGlvbidzIGNsb3NpbmcgdGltZSBpcyBpbmNyZWFzZWQgYnkgdGhlIGJ1ZmZlciB0byBwcmV2ZW50IGJ1eWVycyBmcm9tIG1ha2luZyBsYXN0IG1pbnV0ZSB3aW5uaW5nIGJpZHMsIGFuZCB0byBnaXZlIHRpbWUgdG8gb3RoZXIgYnV5ZXJzIHRvIG1ha2UgYSBoaWdoZXIgYmlkIGlmIHRoZXkgd2lzaCB0by5cbiAgICogQGV4YW1wbGVcbiAgICogYGBgamF2YXNjcmlwdFxuICAgKiAvLyB0aGUgdGltZSBidWZmZXIgaW4gc2Vjb25kc1xuICAgKiBjb25zdCBidWZmZXJJblNlY29uZHMgPSA2MDtcbiAgICogYXdhaXQgY29udHJhY3Quc2V0VGltZUJ1ZmZlckluU2Vjb25kcyhidWZmZXJJblNlY29uZHMpO1xuICAgKiBgYGBcbiAgICogQHBhcmFtIGJ1ZmZlckluU2Vjb25kcyAtIHRoZSBzZWNvbmRzIHZhbHVlXG4gICAqL1xuICBzZXRUaW1lQnVmZmVySW5TZWNvbmRzID0gLyogQF9fUFVSRV9fICovYnVpbGRUcmFuc2FjdGlvbkZ1bmN0aW9uKGFzeW5jIGJ1ZmZlckluU2Vjb25kcyA9PiB7XG4gICAgYXdhaXQgdGhpcy5yb2xlcy52ZXJpZnkoW1wiYWRtaW5cIl0sIGF3YWl0IHRoaXMuY29udHJhY3RXcmFwcGVyLmdldFNpZ25lckFkZHJlc3MoKSk7XG4gICAgY29uc3QgYmlkQnVmZmVyID0gYXdhaXQgdGhpcy5nZXRCaWRCdWZmZXJCcHMoKTtcbiAgICByZXR1cm4gVHJhbnNhY3Rpb24uZnJvbUNvbnRyYWN0V3JhcHBlcih7XG4gICAgICBjb250cmFjdFdyYXBwZXI6IHRoaXMuY29udHJhY3RXcmFwcGVyLFxuICAgICAgbWV0aG9kOiBcInNldEF1Y3Rpb25CdWZmZXJzXCIsXG4gICAgICBhcmdzOiBbQmlnTnVtYmVyLmZyb20oYnVmZmVySW5TZWNvbmRzKSwgYmlkQnVmZmVyXVxuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogUmVzdHJpY3QgbGlzdGluZyBORlRzIG9ubHkgZnJvbSB0aGUgc3BlY2lmaWVkIE5GVCBjb250cmFjdCBhZGRyZXNzLlxuICAgKiBJdCBpcyBwb3NzaWJsZSB0byBhbGxvdyBsaXN0aW5nIGZyb20gbXVsdGlwbGUgY29udHJhY3QgYWRkcmVzc2VzLlxuICAgKiBAcGFyYW0gY29udHJhY3RBZGRyZXNzIC0gdGhlIE5GVCBjb250cmFjdCBhZGRyZXNzXG4gICAqL1xuICBhbGxvd0xpc3RpbmdGcm9tU3BlY2lmaWNBc3NldE9ubHkgPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgY29udHJhY3RBZGRyZXNzID0+IHtcbiAgICBjb25zdCBlbmNvZGVkID0gW107XG4gICAgY29uc3QgbWVtYmVycyA9IGF3YWl0IHRoaXMucm9sZXMuZ2V0KFwiYXNzZXRcIik7XG4gICAgaWYgKG1lbWJlcnMuaW5jbHVkZXMoY29uc3RhbnRzLkFkZHJlc3NaZXJvKSkge1xuICAgICAgZW5jb2RlZC5wdXNoKHRoaXMuZW5jb2Rlci5lbmNvZGUoXCJyZXZva2VSb2xlXCIsIFtnZXRSb2xlSGFzaChcImFzc2V0XCIpLCBjb25zdGFudHMuQWRkcmVzc1plcm9dKSk7XG4gICAgfVxuICAgIGVuY29kZWQucHVzaCh0aGlzLmVuY29kZXIuZW5jb2RlKFwiZ3JhbnRSb2xlXCIsIFtnZXRSb2xlSGFzaChcImFzc2V0XCIpLCBjb250cmFjdEFkZHJlc3NdKSk7XG4gICAgcmV0dXJuIFRyYW5zYWN0aW9uLmZyb21Db250cmFjdFdyYXBwZXIoe1xuICAgICAgY29udHJhY3RXcmFwcGVyOiB0aGlzLmNvbnRyYWN0V3JhcHBlcixcbiAgICAgIG1ldGhvZDogXCJtdWx0aWNhbGxcIixcbiAgICAgIGFyZ3M6IFtlbmNvZGVkXVxuICAgIH0pO1xuICB9KTtcblxuICAvKipcbiAgICogQWxsb3cgbGlzdGluZ3MgZnJvbSBhbnkgTkZUIGNvbnRyYWN0XG4gICAqL1xuICBhbGxvd0xpc3RpbmdGcm9tQW55QXNzZXQgPSAvKiBAX19QVVJFX18gKi9idWlsZFRyYW5zYWN0aW9uRnVuY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGVuY29kZWQgPSBbXTtcbiAgICBjb25zdCBtZW1iZXJzID0gYXdhaXQgdGhpcy5yb2xlcy5nZXQoXCJhc3NldFwiKTtcbiAgICBmb3IgKGNvbnN0IGFkZHIgaW4gbWVtYmVycykge1xuICAgICAgZW5jb2RlZC5wdXNoKHRoaXMuZW5jb2Rlci5lbmNvZGUoXCJyZXZva2VSb2xlXCIsIFtnZXRSb2xlSGFzaChcImFzc2V0XCIpLCBhZGRyXSkpO1xuICAgIH1cbiAgICBlbmNvZGVkLnB1c2godGhpcy5lbmNvZGVyLmVuY29kZShcImdyYW50Um9sZVwiLCBbZ2V0Um9sZUhhc2goXCJhc3NldFwiKSwgY29uc3RhbnRzLkFkZHJlc3NaZXJvXSkpO1xuICAgIHJldHVybiBUcmFuc2FjdGlvbi5mcm9tQ29udHJhY3RXcmFwcGVyKHtcbiAgICAgIGNvbnRyYWN0V3JhcHBlcjogdGhpcy5jb250cmFjdFdyYXBwZXIsXG4gICAgICBtZXRob2Q6IFwibXVsdGljYWxsXCIsXG4gICAgICBhcmdzOiBbZW5jb2RlZF1cbiAgICB9KTtcbiAgfSk7XG5cbiAgLyoqICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBQUklWQVRFIEZVTkNUSU9OU1xuICAgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuICBhc3luYyBnZXRBbGxMaXN0aW5nc05vRmlsdGVyKGZpbHRlckludmFsaWRMaXN0aW5ncykge1xuICAgIGNvbnN0IGxpc3RpbmdzID0gYXdhaXQgUHJvbWlzZS5hbGwoQXJyYXkuZnJvbShBcnJheSgoYXdhaXQgdGhpcy5jb250cmFjdFdyYXBwZXIucmVhZChcInRvdGFsTGlzdGluZ3NcIiwgW10pKS50b051bWJlcigpKS5rZXlzKCkpLm1hcChhc3luYyBpID0+IHtcbiAgICAgIGxldCBsaXN0aW5nO1xuICAgICAgdHJ5IHtcbiAgICAgICAgbGlzdGluZyA9IGF3YWl0IHRoaXMuZ2V0TGlzdGluZyhpKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgTGlzdGluZ05vdEZvdW5kRXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIGdldCBsaXN0aW5nICR7aX0nIC0gc2tpcHBpbmcuIFRyeSAnbWFya2V0cGxhY2UuZ2V0TGlzdGluZygke2l9KScgdG8gZ2V0IHRoZSB1bmRlcmx5aW5nIGVycm9yLmApO1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChsaXN0aW5nLnR5cGUgPT09IExpc3RpbmdUeXBlLkF1Y3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIGxpc3Rpbmc7XG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVySW52YWxpZExpc3RpbmdzKSB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICB2YWxpZFxuICAgICAgICB9ID0gYXdhaXQgdGhpcy5kaXJlY3QuaXNTdGlsbFZhbGlkTGlzdGluZyhsaXN0aW5nKTtcbiAgICAgICAgaWYgKCF2YWxpZCkge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBsaXN0aW5nO1xuICAgIH0pKTtcbiAgICByZXR1cm4gbGlzdGluZ3MuZmlsdGVyKGwgPT4gbCAhPT0gdW5kZWZpbmVkKTtcbiAgfVxuICBhcHBseUZpbHRlcihsaXN0aW5ncywgZmlsdGVyKSB7XG4gICAgbGV0IHJhd0xpc3RpbmdzID0gWy4uLmxpc3RpbmdzXTtcbiAgICBjb25zdCBzdGFydCA9IEJpZ051bWJlci5mcm9tKGZpbHRlcj8uc3RhcnQgfHwgMCkudG9OdW1iZXIoKTtcbiAgICBjb25zdCBjb3VudCA9IEJpZ051bWJlci5mcm9tKGZpbHRlcj8uY291bnQgfHwgREVGQVVMVF9RVUVSWV9BTExfQ09VTlQpLnRvTnVtYmVyKCk7XG4gICAgaWYgKGZpbHRlcikge1xuICAgICAgaWYgKGZpbHRlci5zZWxsZXIpIHtcbiAgICAgICAgcmF3TGlzdGluZ3MgPSByYXdMaXN0aW5ncy5maWx0ZXIoc2VsbGVyID0+IHNlbGxlci5zZWxsZXJBZGRyZXNzLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA9PT0gZmlsdGVyPy5zZWxsZXI/LnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSk7XG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVyLnRva2VuQ29udHJhY3QpIHtcbiAgICAgICAgcmF3TGlzdGluZ3MgPSByYXdMaXN0aW5ncy5maWx0ZXIodG9rZW5Db250cmFjdCA9PiB0b2tlbkNvbnRyYWN0LmFzc2V0Q29udHJhY3RBZGRyZXNzLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKSA9PT0gZmlsdGVyPy50b2tlbkNvbnRyYWN0Py50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfVxuICAgICAgaWYgKGZpbHRlci50b2tlbklkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmF3TGlzdGluZ3MgPSByYXdMaXN0aW5ncy5maWx0ZXIodG9rZW5Db250cmFjdCA9PiB0b2tlbkNvbnRyYWN0LnRva2VuSWQudG9TdHJpbmcoKSA9PT0gZmlsdGVyPy50b2tlbklkPy50b1N0cmluZygpKTtcbiAgICAgIH1cbiAgICAgIHJhd0xpc3RpbmdzID0gcmF3TGlzdGluZ3MuZmlsdGVyKChfLCBpbmRleCkgPT4gaW5kZXggPj0gc3RhcnQpO1xuICAgICAgcmF3TGlzdGluZ3MgPSByYXdMaXN0aW5ncy5zbGljZSgwLCBjb3VudCk7XG4gICAgfVxuICAgIHJldHVybiByYXdMaXN0aW5ncztcbiAgfVxuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGFzeW5jIHByZXBhcmUobWV0aG9kLCBhcmdzLCBvdmVycmlkZXMpIHtcbiAgICByZXR1cm4gVHJhbnNhY3Rpb24uZnJvbUNvbnRyYWN0V3JhcHBlcih7XG4gICAgICBjb250cmFjdFdyYXBwZXI6IHRoaXMuY29udHJhY3RXcmFwcGVyLFxuICAgICAgbWV0aG9kLFxuICAgICAgYXJncyxcbiAgICAgIG92ZXJyaWRlc1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgYXN5bmMgY2FsbChmdW5jdGlvbk5hbWUsIGFyZ3MsIG92ZXJyaWRlcykge1xuICAgIHJldHVybiB0aGlzLmNvbnRyYWN0V3JhcHBlci5jYWxsKGZ1bmN0aW9uTmFtZSwgYXJncywgb3ZlcnJpZGVzKTtcbiAgfVxufVxuXG5leHBvcnQgeyBNYXJrZXRwbGFjZSB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(app-pages-browser)/./node_modules/@thirdweb-dev/sdk/dist/marketplace-2e2adc0e.browser.esm.js\n"));

/***/ })

}]);